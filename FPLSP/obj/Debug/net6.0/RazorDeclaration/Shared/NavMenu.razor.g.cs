// <auto-generated/>
#pragma warning disable 1591
#pragma warning disable 0414
#pragma warning disable 0649
#pragma warning disable 0169

namespace FPLSP.Shared
{
    #line hidden
    using System;
    using System.Collections.Generic;
    using System.Linq;
    using System.Threading.Tasks;
    using Microsoft.AspNetCore.Components;
#nullable restore
#line 1 "C:\Users\Nguyen Bui\source\repos\FPLSP3\FPLSP\_Imports.razor"
using System.Net.Http;

#line default
#line hidden
#nullable disable
#nullable restore
#line 2 "C:\Users\Nguyen Bui\source\repos\FPLSP3\FPLSP\_Imports.razor"
using Microsoft.AspNetCore.Authorization;

#line default
#line hidden
#nullable disable
#nullable restore
#line 3 "C:\Users\Nguyen Bui\source\repos\FPLSP3\FPLSP\_Imports.razor"
using Microsoft.AspNetCore.Components.Authorization;

#line default
#line hidden
#nullable disable
#nullable restore
#line 4 "C:\Users\Nguyen Bui\source\repos\FPLSP3\FPLSP\_Imports.razor"
using Microsoft.AspNetCore.Components.Forms;

#line default
#line hidden
#nullable disable
#nullable restore
#line 5 "C:\Users\Nguyen Bui\source\repos\FPLSP3\FPLSP\_Imports.razor"
using Microsoft.AspNetCore.Components.Routing;

#line default
#line hidden
#nullable disable
#nullable restore
#line 6 "C:\Users\Nguyen Bui\source\repos\FPLSP3\FPLSP\_Imports.razor"
using Microsoft.AspNetCore.Components.Web;

#line default
#line hidden
#nullable disable
#nullable restore
#line 7 "C:\Users\Nguyen Bui\source\repos\FPLSP3\FPLSP\_Imports.razor"
using Microsoft.AspNetCore.Components.Web.Virtualization;

#line default
#line hidden
#nullable disable
#nullable restore
#line 8 "C:\Users\Nguyen Bui\source\repos\FPLSP3\FPLSP\_Imports.razor"
using Microsoft.JSInterop;

#line default
#line hidden
#nullable disable
#nullable restore
#line 9 "C:\Users\Nguyen Bui\source\repos\FPLSP3\FPLSP\_Imports.razor"
using FPLSP;

#line default
#line hidden
#nullable disable
#nullable restore
#line 10 "C:\Users\Nguyen Bui\source\repos\FPLSP3\FPLSP\_Imports.razor"
using FPLSP.Shared;

#line default
#line hidden
#nullable disable
#nullable restore
#line 11 "C:\Users\Nguyen Bui\source\repos\FPLSP3\FPLSP\_Imports.razor"
using MudBlazor;

#line default
#line hidden
#nullable disable
#nullable restore
#line 12 "C:\Users\Nguyen Bui\source\repos\FPLSP3\FPLSP\_Imports.razor"
using FPLSP.Components;

#line default
#line hidden
#nullable disable
#nullable restore
#line 13 "C:\Users\Nguyen Bui\source\repos\FPLSP3\FPLSP\_Imports.razor"
using Blazored.Typeahead;

#line default
#line hidden
#nullable disable
#nullable restore
#line 14 "C:\Users\Nguyen Bui\source\repos\FPLSP3\FPLSP\_Imports.razor"
using CurrieTechnologies.Razor.SweetAlert2;

#line default
#line hidden
#nullable disable
#nullable restore
#line 1 "C:\Users\Nguyen Bui\source\repos\FPLSP3\FPLSP\Shared\NavMenu.razor"
using AntDesign;

#line default
#line hidden
#nullable disable
#nullable restore
#line 2 "C:\Users\Nguyen Bui\source\repos\FPLSP3\FPLSP\Shared\NavMenu.razor"
using Blazored.LocalStorage;

#line default
#line hidden
#nullable disable
#nullable restore
#line 3 "C:\Users\Nguyen Bui\source\repos\FPLSP3\FPLSP\Shared\NavMenu.razor"
using Blazored.Toast.Services;

#line default
#line hidden
#nullable disable
#nullable restore
#line 4 "C:\Users\Nguyen Bui\source\repos\FPLSP3\FPLSP\Shared\NavMenu.razor"
using FPLSP.Data.Securities;

#line default
#line hidden
#nullable disable
#nullable restore
#line 5 "C:\Users\Nguyen Bui\source\repos\FPLSP3\FPLSP\Shared\NavMenu.razor"
using FPLSP.Repositories.Interfaces;

#line default
#line hidden
#nullable disable
#nullable restore
#line 6 "C:\Users\Nguyen Bui\source\repos\FPLSP3\FPLSP\Shared\NavMenu.razor"
using FPLSP.Server.Data.SeedWork;

#line default
#line hidden
#nullable disable
#nullable restore
#line 9 "C:\Users\Nguyen Bui\source\repos\FPLSP3\FPLSP\Shared\NavMenu.razor"
using FPLSP.Server.Domain.Dtos;

#line default
#line hidden
#nullable disable
#nullable restore
#line 10 "C:\Users\Nguyen Bui\source\repos\FPLSP3\FPLSP\Shared\NavMenu.razor"
using FPLSP.Server.Domain.Entities.CoresParts;

#line default
#line hidden
#nullable disable
#nullable restore
#line 11 "C:\Users\Nguyen Bui\source\repos\FPLSP3\FPLSP\Shared\NavMenu.razor"
using FPLSP.Server.Infrastructure.ViewModels;

#line default
#line hidden
#nullable disable
#nullable restore
#line 12 "C:\Users\Nguyen Bui\source\repos\FPLSP3\FPLSP\Shared\NavMenu.razor"
using IdentityServer4;

#line default
#line hidden
#nullable disable
#nullable restore
#line 13 "C:\Users\Nguyen Bui\source\repos\FPLSP3\FPLSP\Shared\NavMenu.razor"
using Microsoft.AspNetCore.Authentication;

#line default
#line hidden
#nullable disable
#nullable restore
#line 14 "C:\Users\Nguyen Bui\source\repos\FPLSP3\FPLSP\Shared\NavMenu.razor"
using Microsoft.AspNetCore.Components.Server.ProtectedBrowserStorage;

#line default
#line hidden
#nullable disable
#nullable restore
#line 15 "C:\Users\Nguyen Bui\source\repos\FPLSP3\FPLSP\Shared\NavMenu.razor"
using Microsoft.AspNetCore.DataProtection;

#line default
#line hidden
#nullable disable
#nullable restore
#line 16 "C:\Users\Nguyen Bui\source\repos\FPLSP3\FPLSP\Shared\NavMenu.razor"
using Microsoft.AspNetCore.Identity;

#line default
#line hidden
#nullable disable
#nullable restore
#line 17 "C:\Users\Nguyen Bui\source\repos\FPLSP3\FPLSP\Shared\NavMenu.razor"
using System.Text.RegularExpressions;

#line default
#line hidden
#nullable disable
#nullable restore
#line 20 "C:\Users\Nguyen Bui\source\repos\FPLSP3\FPLSP\Shared\NavMenu.razor"
           [Authorize(Roles = "AdminCore,AdminCS,LecturerFPLSP,Lecturer,DirectorOfTraining,Staff,HeadOfDepartment")]

#line default
#line hidden
#nullable disable
    public partial class NavMenu : global::Microsoft.AspNetCore.Components.ComponentBase
    {
        #pragma warning disable 1998
        protected override void BuildRenderTree(global::Microsoft.AspNetCore.Components.Rendering.RenderTreeBuilder __builder)
        {
        }
        #pragma warning restore 1998
#nullable restore
#line 490 "C:\Users\Nguyen Bui\source\repos\FPLSP3\FPLSP\Shared\NavMenu.razor"
       
    [Inject] public IHttpContextAccessor _httpContextAccessor { get; set; }
    [Inject] public IToastService _toastService { get; set; }
    [Inject] public UserManager<UserSignIn> _Usermanager { get; set; }

    [Inject]
    public IRoleUserIdentityRepo _roleUserIdentityRepo { get; set; }
    private List<IdentityRole> _lstRole = new List<IdentityRole>();
    private PagingParameters _pagingParameters = new PagingParameters();
    public MetaData MetaData { get; set; } = new MetaData();
    [Inject] public IUserIdentityRepo _UserIdentityRepo { get; set; }
    [Inject] public IStudentUPRepo _StudentRepo { get; set; }
    [Inject] public IDashboardClient _StudentClient { get; set; }
    private List<UserInListRoles> _lstUsers = new List<UserInListRoles>();
    private List<string> _lstRoless = new List<string>();
    private int MaxlevelOfRole;
    private LecturersCP ileture = new LecturersCP();
    private string RoleDisPlay = "";
    private string TrainingDisplay = "";
    private string fistusername = "";
    private Guid IdGV = Guid.Empty;
    private string IdTrain = "169a0425-7e5a-4057-9748-32f1cf3c1479"; //Chưa chọn được cơ sở nên fake id cứng
    private List<int> _savevaluesofRole = new List<int>();
    private UserInListRoles userRole = new UserInListRoles();
    [Inject] public NavigationManager navigationManager { get; set; }
    private TrainingFacilitiesCPViewModel trainingFacilities = new TrainingFacilitiesCPViewModel();
    [Inject] public ILecturersCPRepo _lecturersCPRepo { get; set; }
    [Inject] public ITrainingFacilitiesCPRepo _trainingFacilitiesCP { get; set; }
    [Inject] public ILectuterSpecializedCPCilents _lecturespecializedCPCilents { get; set; }
    [Inject] public ISpecializedCPRepo _specializedCPRepo { get; set; }
    private List<SpecializedDto> _lstAll = new List<SpecializedDto>();
    [Inject]
    public AuthenticationStateProvider AuthenticationState { get; set; }
    string patern = "^([a-z]{3,13}[0-9]{0,3}@fpt-edu-vn)$";
    private Guid getIdCoSo;
    private string imageUser = "";
    private string IdUser = "";
    //[Inject]
    //public  IDataProtector _protector { get; set; }
    //[Inject]
    //public IDataProtectionProvider protector { get; set; }
    //private HashParameterValues hashParameterValues = new HashParameterValues();
    [Inject]
    public CryptoServices _cryptoServices { get; set; }
    private string fistusernamemahoa = "";
    /// <summary>
    /// Sử dụng AntDesign

    RenderFragment sub1Title =
    

#line default
#line hidden
#nullable disable
        (__builder2) => {
            __builder2.AddMarkupContent(0, "<span b-wf181y44vx>\r\n        <Icon Type=\"appstore\" Theme=\"outline\" b-wf181y44vx></Icon>\r\n        Chuyên ngành\r\n    </span>");
        }
#nullable restore
#line 542 "C:\Users\Nguyen Bui\source\repos\FPLSP3\FPLSP\Shared\NavMenu.razor"
           ;

    RenderFragment sub2Title =
    

#line default
#line hidden
#nullable disable
        (__builder2) => {
            __builder2.AddMarkupContent(1, "<span b-wf181y44vx>\r\n        <Icon Type=\"setting\" Theme=\"outline\" b-wf181y44vx></Icon>\r\n        Chuyên ngành\r\n        </span>\r\n");
        }
#nullable restore
#line 549 "C:\Users\Nguyen Bui\source\repos\FPLSP3\FPLSP\Shared\NavMenu.razor"
    ;

    MenuMode mode = MenuMode.Inline;
    MenuTheme theme = MenuTheme.Light;

    void changeMode(bool value)
    {
        this.mode = value ? MenuMode.Vertical : MenuMode.Inline;
    }

    void changeTheme(bool value)
    {
        this.theme = value ? MenuTheme.Dark : MenuTheme.Light;
    }
    /// </summary>
    private UserSignIn userAuthen = new UserSignIn();
    //
    private IList<string?> getlistrole = new List<string>();
    [CascadingParameter]
    private Task<AuthenticationState> authenticationStateTask { get; set; }
    protected override async Task OnInitializedAsync()
    {

        var  authState = await authenticationStateTask;
        var user = authState.User;


        if (user.Identity.IsAuthenticated)
        {
            fistusername = user.Claims.ToList()[4].Value.ToString();
            imageUser = user.Claims.ToList()[6].Value.ToString();
            userAuthen = _Usermanager.Users.ToList().Find(c => c.Email == fistusername);

            fistusernamemahoa = _cryptoServices.Encrypt(fistusername).Replace("/", "I0H");
            getlistrole = await _Usermanager.GetRolesAsync(userAuthen);
            getIdCoSo = userAuthen.IdTrainingFacility;
            IdUser = userAuthen.Id;
            RoleDisPlay = String.Join(" , ", getlistrole.ToArray());


            //lấy ra tên cơ sở đào tạo
            trainingFacilities = await _trainingFacilitiesCP.GetTrainingFacilityListById(userAuthen.IdTrainingFacility);
            TrainingDisplay = trainingFacilities.TrainingInstitutionName;
            // lấy ra quyền to nhất của role để xét quyền phục vụ cho chức năng cấp quyền
            //các quyền được xếp theo thứ tự giảm dần, quyền có số càng lớn thì quyền càng lớn
            //AdminCore(7),AdminCS(6),DirectorOfTraining(5),HeadOfDepartment(4),Staff(3),Lecturer(2),Student(1)
            if (getlistrole.ToList().Any(c => c == "AdminCore"))
            {

                _savevaluesofRole.Add(7);
            }
            else if (getlistrole.ToList().Any(c => c == "AdminCS"))
            {
                _savevaluesofRole.Add(6);
            }
            else if (getlistrole.ToList().Any(c => c == "DirectorOfTraining"))
            {
                _savevaluesofRole.Add(5);
            }
            else if (getlistrole.ToList().Any(c => c == "HeadOfDepartment"))
            {
                _savevaluesofRole.Add(4);
            }
            else if (getlistrole.ToList().Any(c => c == "Staff"))
            {
                _savevaluesofRole.Add(3);
            }
            else if (getlistrole.ToList().Any(c => c == "LecturerFPLSP"))
            {
                _savevaluesofRole.Add(2);
                var letspec = await _lecturespecializedCPCilents.GetAllAsync();
                var lstIdspec = letspec.Where(c => c.Idlecturers == Guid.Parse(IdUser)).Select(c => c.Idspecialized);
                var lstspec = await _specializedCPRepo.GetAll();
                _lstAll = lstspec.Where(c => lstIdspec.Contains(c.Id)).ToList();
            }
            else if (getlistrole.ToList().Any(c => c == "Lecturer"))
            {
                _savevaluesofRole.Add(1);
            }
            else if (getlistrole.ToList().Any(c => c == "Student"))
            {
                _savevaluesofRole.Add(0);
            }
            //sau đó chọn ra 1 quyền to nhất để thực hiện các chức năng
            MaxlevelOfRole = _savevaluesofRole.Max();

        }
        else
        {

            fistusername = "ViewerUser";
        }
    }
    private async Task ForceReloadExamRoomStu(string IdUser)
    {
        NavigationManager.NavigateTo($"/allofexaminationstudent/{IdUser}", true);
    }
    private async Task JoinRoom(string IdUser)
    {
        NavigationManager.NavigateTo($"/loadingpage/{IdUser}", true);
    }
    private async Task ForceExamRoomGV(string IdUser)
    {
        NavigationManager.NavigateTo($"/countdownexamnination/{IdUser}", true);
    }
    private async Task ForceReloadSubjetGV(string IdUser)
    {
        NavigationManager.NavigateTo($"/overviewsubject/{_cryptoServices.Encrypt("GV FPLExam")}/{_cryptoServices.Encrypt(IdUser)}", true);
    }




    protected async override Task OnAfterRenderAsync(bool firstRender)
    {
        //if (firstRender)
        //{
        //      var result = await ProtectedSessionStore.GetAsync<string>("User");
        //      Console.WriteLine(result.Value.ToString());
        //    fistusername = result.Value.ToString();
        //}
       
    }
    private async Task<string> GetUserName()
    {


        return fistusername;
    }
    private async Task RedirecToSpec(string id)
    {
        string a = "";
        string b = "";
        a = _cryptoServices.Encrypt(IdUser).Replace("/", "I0H");
        b = id.Replace("/", "I0H");
        navigationManager.NavigateTo($"/AllDanhSachLopOfLecucu/{a}");
        navigationManager.NavigateTo($"/LectuterSpecializedSubjectls/{a}/{b}");
    }
    private async Task RedirecToAllClass()
    {
        string a = "";
        a = _cryptoServices.Encrypt(IdUser).Replace("/", "I0H");
        navigationManager.NavigateTo($"/AllDanhSachLopOfLecucu/{a}");
        navigationManager.NavigateTo($"/AllDanhSachLopOfLecucu/{a}");
    }


#line default
#line hidden
#nullable disable
        [global::Microsoft.AspNetCore.Components.InjectAttribute] private ProtectedSessionStorage ProtectedSessionStore { get; set; }
        [global::Microsoft.AspNetCore.Components.InjectAttribute] private NavigationManager NavigationManager { get; set; }
        [global::Microsoft.AspNetCore.Components.InjectAttribute] private ILocalStorageService _localStorageService { get; set; }
        [global::Microsoft.AspNetCore.Components.InjectAttribute] private UserManager<UserSignIn> _userManager { get; set; }
    }
}
#pragma warning restore 1591
