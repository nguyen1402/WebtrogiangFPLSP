#pragma checksum "C:\Users\Nguyen Bui\source\repos\FPLSP3\FPLSP\Pages\GetVideoPages\GetVideo.razor" "{ff1816ec-aa5e-4d10-87f7-6f4963833460}" "fb336e7528377c2d15de467ddac892f8de735ee5"
// <auto-generated/>
#pragma warning disable 1591
namespace FPLSP.Pages.GetVideoPages
{
    #line hidden
    using System;
    using System.Collections.Generic;
    using System.Linq;
    using System.Threading.Tasks;
#nullable restore
#line 1 "C:\Users\Nguyen Bui\source\repos\FPLSP3\FPLSP\_Imports.razor"
using System.Net.Http;

#line default
#line hidden
#nullable disable
#nullable restore
#line 2 "C:\Users\Nguyen Bui\source\repos\FPLSP3\FPLSP\_Imports.razor"
using Microsoft.AspNetCore.Authorization;

#line default
#line hidden
#nullable disable
#nullable restore
#line 3 "C:\Users\Nguyen Bui\source\repos\FPLSP3\FPLSP\_Imports.razor"
using Microsoft.AspNetCore.Components.Authorization;

#line default
#line hidden
#nullable disable
#nullable restore
#line 4 "C:\Users\Nguyen Bui\source\repos\FPLSP3\FPLSP\_Imports.razor"
using Microsoft.AspNetCore.Components.Forms;

#line default
#line hidden
#nullable disable
#nullable restore
#line 5 "C:\Users\Nguyen Bui\source\repos\FPLSP3\FPLSP\_Imports.razor"
using Microsoft.AspNetCore.Components.Routing;

#line default
#line hidden
#nullable disable
#nullable restore
#line 6 "C:\Users\Nguyen Bui\source\repos\FPLSP3\FPLSP\_Imports.razor"
using Microsoft.AspNetCore.Components.Web;

#line default
#line hidden
#nullable disable
#nullable restore
#line 7 "C:\Users\Nguyen Bui\source\repos\FPLSP3\FPLSP\_Imports.razor"
using Microsoft.AspNetCore.Components.Web.Virtualization;

#line default
#line hidden
#nullable disable
#nullable restore
#line 8 "C:\Users\Nguyen Bui\source\repos\FPLSP3\FPLSP\_Imports.razor"
using Microsoft.JSInterop;

#line default
#line hidden
#nullable disable
#nullable restore
#line 9 "C:\Users\Nguyen Bui\source\repos\FPLSP3\FPLSP\_Imports.razor"
using FPLSP;

#line default
#line hidden
#nullable disable
#nullable restore
#line 10 "C:\Users\Nguyen Bui\source\repos\FPLSP3\FPLSP\_Imports.razor"
using FPLSP.Shared;

#line default
#line hidden
#nullable disable
#nullable restore
#line 11 "C:\Users\Nguyen Bui\source\repos\FPLSP3\FPLSP\_Imports.razor"
using MudBlazor;

#line default
#line hidden
#nullable disable
#nullable restore
#line 12 "C:\Users\Nguyen Bui\source\repos\FPLSP3\FPLSP\_Imports.razor"
using FPLSP.Components;

#line default
#line hidden
#nullable disable
#nullable restore
#line 13 "C:\Users\Nguyen Bui\source\repos\FPLSP3\FPLSP\_Imports.razor"
using Blazored.Typeahead;

#line default
#line hidden
#nullable disable
#nullable restore
#line 14 "C:\Users\Nguyen Bui\source\repos\FPLSP3\FPLSP\_Imports.razor"
using CurrieTechnologies.Razor.SweetAlert2;

#line default
#line hidden
#nullable disable
#nullable restore
#line 2 "C:\Users\Nguyen Bui\source\repos\FPLSP3\FPLSP\Pages\GetVideoPages\GetVideo.razor"
using Blazored.Toast.Services;

#line default
#line hidden
#nullable disable
#nullable restore
#line 3 "C:\Users\Nguyen Bui\source\repos\FPLSP3\FPLSP\Pages\GetVideoPages\GetVideo.razor"
using FPLSP.Repositories;

#line default
#line hidden
#nullable disable
#nullable restore
#line 4 "C:\Users\Nguyen Bui\source\repos\FPLSP3\FPLSP\Pages\GetVideoPages\GetVideo.razor"
using FPLSP.Repositories.Interfaces;

#line default
#line hidden
#nullable disable
#nullable restore
#line 5 "C:\Users\Nguyen Bui\source\repos\FPLSP3\FPLSP\Pages\GetVideoPages\GetVideo.razor"
using FPLSP.Server.Domain.Dtos;

#line default
#line hidden
#nullable disable
#nullable restore
#line 6 "C:\Users\Nguyen Bui\source\repos\FPLSP3\FPLSP\Pages\GetVideoPages\GetVideo.razor"
using Microsoft.AspNetCore.Components;

#line default
#line hidden
#nullable disable
#nullable restore
#line 7 "C:\Users\Nguyen Bui\source\repos\FPLSP3\FPLSP\Pages\GetVideoPages\GetVideo.razor"
using Newtonsoft.Json.Linq;

#line default
#line hidden
#nullable disable
#nullable restore
#line 8 "C:\Users\Nguyen Bui\source\repos\FPLSP3\FPLSP\Pages\GetVideoPages\GetVideo.razor"
using System.Net;

#line default
#line hidden
#nullable disable
#nullable restore
#line 9 "C:\Users\Nguyen Bui\source\repos\FPLSP3\FPLSP\Pages\GetVideoPages\GetVideo.razor"
           [Authorize(Roles = "Student")]

#line default
#line hidden
#nullable disable
    [global::Microsoft.AspNetCore.Components.RouteAttribute("/getvideo/{idsj}/{linkid}/{code}/{lessonId}/{name}")]
    public partial class GetVideo : global::Microsoft.AspNetCore.Components.ComponentBase
    {
        #pragma warning disable 1998
        protected override void BuildRenderTree(global::Microsoft.AspNetCore.Components.Rendering.RenderTreeBuilder __builder)
        {
#nullable restore
#line 10 "C:\Users\Nguyen Bui\source\repos\FPLSP3\FPLSP\Pages\GetVideoPages\GetVideo.razor"
 if (video != null)
{

#line default
#line hidden
#nullable disable
            __builder.OpenElement(0, "nav");
            __builder.AddAttribute(1, "aria-label", "breadcrumb");
            __builder.OpenElement(2, "ol");
            __builder.AddAttribute(3, "class", "breadcrumb");
            __builder.OpenElement(4, "li");
            __builder.AddAttribute(5, "class", "breadcrumb-item");
            __builder.OpenElement(6, "a");
            __builder.AddAttribute(7, "href", "/subjects");
            __builder.AddMarkupContent(8, "Môn:");
#nullable restore
#line (14,66)-(14,77) 24 "C:\Users\Nguyen Bui\source\repos\FPLSP3\FPLSP\Pages\GetVideoPages\GetVideo.razor"
__builder.AddContent(9, nameSubject);

#line default
#line hidden
#nullable disable
            __builder.CloseElement();
            __builder.CloseElement();
            __builder.AddMarkupContent(10, "\r\n            ");
            __builder.OpenElement(11, "li");
            __builder.AddAttribute(12, "class", "breadcrumb-item");
            __builder.OpenElement(13, "a");
            __builder.AddAttribute(14, "href", "/lesson/" + (
#nullable restore
#line 15 "C:\Users\Nguyen Bui\source\repos\FPLSP3\FPLSP\Pages\GetVideoPages\GetVideo.razor"
                                                          lessonId

#line default
#line hidden
#nullable disable
            ));
#nullable restore
#line (15,70)-(15,80) 25 "C:\Users\Nguyen Bui\source\repos\FPLSP3\FPLSP\Pages\GetVideoPages\GetVideo.razor"
__builder.AddContent(15, nameLesson);

#line default
#line hidden
#nullable disable
            __builder.CloseElement();
            __builder.CloseElement();
            __builder.AddMarkupContent(16, "\r\n            ");
            __builder.OpenElement(17, "li");
            __builder.AddAttribute(18, "class", "breadcrumb-item active");
            __builder.AddAttribute(19, "aria-current", "page");
#nullable restore
#line (16,70)-(16,74) 25 "C:\Users\Nguyen Bui\source\repos\FPLSP3\FPLSP\Pages\GetVideoPages\GetVideo.razor"
__builder.AddContent(20, code);

#line default
#line hidden
#nullable disable
            __builder.AddContent(21, " - ");
#nullable restore
#line (16,79)-(16,114) 25 "C:\Users\Nguyen Bui\source\repos\FPLSP3\FPLSP\Pages\GetVideoPages\GetVideo.razor"
__builder.AddContent(22, lesssonContentDto.LessonContentName);

#line default
#line hidden
#nullable disable
            __builder.CloseElement();
            __builder.CloseElement();
            __builder.CloseElement();
            __builder.AddMarkupContent(23, "\r\n    ");
            __builder.OpenElement(24, "h5");
            __builder.AddMarkupContent(25, "Môn: ");
#nullable restore
#line (19,15)-(19,26) 25 "C:\Users\Nguyen Bui\source\repos\FPLSP3\FPLSP\Pages\GetVideoPages\GetVideo.razor"
__builder.AddContent(26, nameSubject);

#line default
#line hidden
#nullable disable
            __builder.AddContent(27, " - ");
#nullable restore
#line (19,30)-(19,40) 25 "C:\Users\Nguyen Bui\source\repos\FPLSP3\FPLSP\Pages\GetVideoPages\GetVideo.razor"
__builder.AddContent(28, nameLesson);

#line default
#line hidden
#nullable disable
            __builder.AddMarkupContent(29, " - Nội Dung: ");
#nullable restore
#line (19,54)-(19,89) 25 "C:\Users\Nguyen Bui\source\repos\FPLSP3\FPLSP\Pages\GetVideoPages\GetVideo.razor"
__builder.AddContent(30, lesssonContentDto.LessonContentName);

#line default
#line hidden
#nullable disable
            __builder.CloseElement();
            __builder.AddMarkupContent(31, "\r\n    ");
            __builder.OpenElement(32, "div");
            __builder.AddAttribute(33, "class", "d-flex align-content-end flex-wrap");
            __builder.OpenElement(34, "a");
            __builder.AddAttribute(35, "type", "button");
            __builder.AddAttribute(36, "class", "btn btn-danger ");
            __builder.AddAttribute(37, "href", "/lessoncontent/" + (
#nullable restore
#line 21 "C:\Users\Nguyen Bui\source\repos\FPLSP3\FPLSP\Pages\GetVideoPages\GetVideo.razor"
                                                                       idsj

#line default
#line hidden
#nullable disable
            ) + "/" + (
#nullable restore
#line 21 "C:\Users\Nguyen Bui\source\repos\FPLSP3\FPLSP\Pages\GetVideoPages\GetVideo.razor"
                                                                             lessonId

#line default
#line hidden
#nullable disable
            ));
            __builder.AddMarkupContent(38, "Quay lại");
            __builder.CloseElement();
            __builder.CloseElement();
            __builder.AddMarkupContent(39, "\r\n    ");
            __builder.OpenElement(40, "div");
            __builder.AddAttribute(41, "class", "row");
            __builder.AddAttribute(42, "style", " padding-top: 30px;");
            __builder.OpenElement(43, "div");
            __builder.AddAttribute(44, "class", "col-lg-11");
            __builder.OpenElement(45, "a");
            __builder.AddAttribute(46, "type", "button");
            __builder.AddAttribute(47, "class", "btn btn-outline-danger");
            __builder.AddAttribute(48, "onclick", global::Microsoft.AspNetCore.Components.EventCallback.Factory.Create<global::Microsoft.AspNetCore.Components.Web.MouseEventArgs>(this, 
#nullable restore
#line 25 "C:\Users\Nguyen Bui\source\repos\FPLSP3\FPLSP\Pages\GetVideoPages\GetVideo.razor"
                                                                      ComeBack

#line default
#line hidden
#nullable disable
            ));
            __builder.AddMarkupContent(49, "\r\n                Previous\r\n            ");
            __builder.CloseElement();
            __builder.CloseElement();
            __builder.AddMarkupContent(50, "\r\n        ");
            __builder.OpenElement(51, "div");
            __builder.AddAttribute(52, "class", "col-lg-1");
            __builder.OpenElement(53, "a");
            __builder.AddAttribute(54, "type", "button");
            __builder.AddAttribute(55, "class", "btn btn-outline-danger");
            __builder.AddAttribute(56, "onclick", global::Microsoft.AspNetCore.Components.EventCallback.Factory.Create<global::Microsoft.AspNetCore.Components.Web.MouseEventArgs>(this, 
#nullable restore
#line 30 "C:\Users\Nguyen Bui\source\repos\FPLSP3\FPLSP\Pages\GetVideoPages\GetVideo.razor"
                                                                      Next

#line default
#line hidden
#nullable disable
            ));
            __builder.AddContent(57, "Next");
            __builder.CloseElement();
            __builder.CloseElement();
            __builder.CloseElement();
            __builder.AddMarkupContent(58, "\r\n    ");
            __builder.OpenElement(59, "iframe");
            __builder.AddAttribute(60, "class", "modal-xl");
            __builder.AddAttribute(61, "style", "margin-left: 40px;height: 580px;padding-top: 10px;");
            __builder.AddAttribute(62, "src", "https://www.youtube.com/embed/" + (
#nullable restore
#line 33 "C:\Users\Nguyen Bui\source\repos\FPLSP3\FPLSP\Pages\GetVideoPages\GetVideo.razor"
                                                                                                                            videoID

#line default
#line hidden
#nullable disable
            ));
            __builder.AddAttribute(63, "frameborder", "0");
            __builder.AddAttribute(64, "allow", "accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture");
            __builder.AddAttribute(65, "allowfullscreen");
            __builder.CloseElement();
            __builder.AddMarkupContent(66, "\r\n    ");
            __builder.OpenElement(67, "div");
            __builder.AddAttribute(68, "class", "d-flex justify-content-center mb-2");
            __builder.OpenElement(69, "div");
            __builder.AddAttribute(70, "class", "d-flex justify-content-center mb-2");
            __builder.OpenElement(71, "div");
            __builder.AddAttribute(72, "class", "p-3");
            __builder.OpenElement(73, "a");
            __builder.AddAttribute(74, "type", "button");
            __builder.AddAttribute(75, "class", "btn btn-outline-danger");
            __builder.AddAttribute(76, "onclick", global::Microsoft.AspNetCore.Components.EventCallback.Factory.Create<global::Microsoft.AspNetCore.Components.Web.MouseEventArgs>(this, 
#nullable restore
#line 37 "C:\Users\Nguyen Bui\source\repos\FPLSP3\FPLSP\Pages\GetVideoPages\GetVideo.razor"
                                                                          ComeBack

#line default
#line hidden
#nullable disable
            ));
            __builder.AddContent(77, "Previous");
            __builder.CloseElement();
            __builder.CloseElement();
            __builder.AddMarkupContent(78, "\r\n            ");
            __builder.OpenElement(79, "div");
            __builder.AddAttribute(80, "class", "p-3");
            __builder.OpenElement(81, "a");
            __builder.AddAttribute(82, "type", "button");
            __builder.AddAttribute(83, "class", "btn btn-outline-danger");
            __builder.AddAttribute(84, "onclick", global::Microsoft.AspNetCore.Components.EventCallback.Factory.Create<global::Microsoft.AspNetCore.Components.Web.MouseEventArgs>(this, 
#nullable restore
#line 39 "C:\Users\Nguyen Bui\source\repos\FPLSP3\FPLSP\Pages\GetVideoPages\GetVideo.razor"
                                                                                        Next

#line default
#line hidden
#nullable disable
            ));
            __builder.AddContent(85, "Next ");
            __builder.CloseElement();
            __builder.CloseElement();
            __builder.CloseElement();
            __builder.CloseElement();
#nullable restore
#line 42 "C:\Users\Nguyen Bui\source\repos\FPLSP3\FPLSP\Pages\GetVideoPages\GetVideo.razor"
}
else
{

#line default
#line hidden
#nullable disable
            __builder.OpenComponent<global::FPLSP.Components.LoadingIndicator>(86);
            __builder.CloseComponent();
#nullable restore
#line 46 "C:\Users\Nguyen Bui\source\repos\FPLSP3\FPLSP\Pages\GetVideoPages\GetVideo.razor"
}

#line default
#line hidden
#nullable disable
        }
        #pragma warning restore 1998
#nullable restore
#line 48 "C:\Users\Nguyen Bui\source\repos\FPLSP3\FPLSP\Pages\GetVideoPages\GetVideo.razor"
       
    [Inject] private IResourceLinkRepo _resourceLinkRepo { get; set; }
    [Inject] private IToastService ToastService { get; set; }
    [Inject] private ILessonContentCPRepo _lessonContentCP { get; set; }
    [Inject] private ILessonCPRepo _lessonCPRepo { get; set; }

    private string nameLesson = string.Empty;

    [Inject] private ISubjectClient _subjectClient { get; set; }

    private string nameSubject = string.Empty;


    private List<ResourceLinkDto> lstvideo { get; set; } = new List<ResourceLinkDto>();
    private ResourceLinkDto video { get; set; } = new ResourceLinkDto();
    private List<LessonContentDto> lstLessonContent { get; set; } = new List<LessonContentDto>();
    private LessonContentDto lesssonContentDto { get; set; } = new LessonContentDto();
    [Parameter]
    public string code { get; set; }
    [Parameter]
    public string name { get; set; }
    [Parameter]
    public string lessonId { get; set; }
    public bool check { get; set; }
    [Parameter]
    public string linkid { get; set; }
    [Parameter]
    public string idsj { get; set; }
    private string a = "";
    private string videoID = "";
    private int b = 0;


    public int Duration { get; set; }
    public DateTime startTime { get; set; }
    protected override async Task OnInitializedAsync()
    {
        if (lesssonContentDto == null)
        {
            lesssonContentDto.LessonContentName = name;
        }
        if (!check)
        {
            var lesson = await _lessonCPRepo.GetbyId(Guid.Parse(lessonId));
            nameLesson = lesson.LessonName + ": " + lesson.Descriptions;
            var subject = await _subjectClient.GetSubjectbyId(Guid.Parse(idsj));
            nameSubject = subject.SubjectCode + "-" + subject.SubjectName;
            lstvideo = await _resourceLinkRepo.GetAllAsync();
            lstLessonContent = await _lessonContentCP.GetAll(Guid.Parse(lessonId));
            video = lstvideo.Find(c => c.Id == Guid.Parse(linkid));
        }
        else
        {
            video = lstvideo.FirstOrDefault(c => c.Id == lesssonContentDto.ResourceLinkId);
            check = false;
        }
        OnPlay();
        getVideoDuration(video.Path);
    }
    private async void Next()
    {
        //if (startTime != default(DateTime))
        //{
        //    var skipTime = DateTime.Now;
        //    var seconds = (skipTime - startTime).TotalSeconds;
        //    if (seconds < Duration * 0.8)
        //    {
        //        ToastService.ShowError("Bạn phải xem tối thiểu 80% thời lượng video trước khi sang bài mới");
        //    }
        //    else
        //    {
        string c;
        a = code.Substring(code.Length - 2, 2);

        b = int.Parse(a);
        b++;
        if (b < 10)
        {
            c = "0" + b.ToString();
        }
        else
        {
            c = b.ToString();
        }
        lesssonContentDto = lstLessonContent.FirstOrDefault(x => x.LessonContentCode == ($"BH{c}"));
        if (lesssonContentDto == null)
        {
            b = b - 1;
            if (b < 10)
            {
                c = "0" + b.ToString();
            }
            else
            {
                c = b.ToString();
            }
            lesssonContentDto = lstLessonContent.FirstOrDefault(x => x.LessonContentCode == ($"BH{c}"));
        }
        code = "BH" + c;
        check = true;
        OnInitializedAsync();
        //    }
        //}
        //else
        //{
        //    ToastService.ShowError("Bạn phải xem tối thiểu 80% thời lượng video trước khi sang bài mới");
        //}

    }
    private void ComeBack()
    {
        string c = "";
        if (b <= 1)
        {
            a = code.Substring(code.Length - 2, 2);
            b = int.Parse(a);
            if (b < 10)
            {
                c = "0" + b.ToString();
            }
            else
            {
                c = b.ToString();
            }
            lesssonContentDto = lstLessonContent.FirstOrDefault(x => x.LessonContentCode == ($"BH{c}"));
        }
        if (b > 1)
        {
            b--;
            if (b < 10)
            {
                c = "0" + b.ToString();
            }
            else
            {
                c = b.ToString();
            }
            lesssonContentDto = lstLessonContent.FirstOrDefault(x => x.LessonContentCode == ($"BH{c}"));
        }
        code = "BH" + c;
        check = true;
        OnInitializedAsync();
    }
    //Kiểm tra thời lượng xem
    public void OnPlay()
    {
        startTime = DateTime.Now;
    }

    public void getVideoDuration(string url)
    {
        videoID = url.Replace("https://www.youtube.com/embed/", "");
        videoID = videoID.Replace("https://www.youtube.com/watch?v=", "");
        videoID = videoID.Replace("https://youtu.be/", "");

        string youtubeKey = "AIzaSyBy4O1cM43Zesp03-h1YTjj1JAhNmwEw9k";
        WebClient myDownloader = new WebClient();
        myDownloader.Encoding = System.Text.Encoding.UTF8;

        string jsonResponse = myDownloader.DownloadString(
        "https://www.googleapis.com/youtube/v3/videos?id=" + videoID + "&key=" + youtubeKey + "&part=contentDetails");

        dynamic dynamicObject = JObject.Parse(jsonResponse);
        string tmp = dynamicObject.items[0].contentDetails.duration;
        Duration = Convert.ToInt32(System.Xml.XmlConvert.ToTimeSpan(tmp).TotalSeconds);
    }


#line default
#line hidden
#nullable disable
    }
}
#pragma warning restore 1591
