#pragma checksum "C:\Users\Nguyen Bui\source\repos\FPLSP3\FPLSP\Pages\UserManagerPages\DetailUserIdentity.razor" "{ff1816ec-aa5e-4d10-87f7-6f4963833460}" "c801c86b43559a4400eb5a996f173aac6cf08d44"
// <auto-generated/>
#pragma warning disable 1591
namespace FPLSP.Pages.UserManagerPages
{
    #line hidden
    using System;
    using System.Collections.Generic;
    using System.Linq;
    using System.Threading.Tasks;
    using Microsoft.AspNetCore.Components;
#nullable restore
#line 1 "C:\Users\Nguyen Bui\source\repos\FPLSP3\FPLSP\_Imports.razor"
using System.Net.Http;

#line default
#line hidden
#nullable disable
#nullable restore
#line 2 "C:\Users\Nguyen Bui\source\repos\FPLSP3\FPLSP\_Imports.razor"
using Microsoft.AspNetCore.Authorization;

#line default
#line hidden
#nullable disable
#nullable restore
#line 3 "C:\Users\Nguyen Bui\source\repos\FPLSP3\FPLSP\_Imports.razor"
using Microsoft.AspNetCore.Components.Authorization;

#line default
#line hidden
#nullable disable
#nullable restore
#line 4 "C:\Users\Nguyen Bui\source\repos\FPLSP3\FPLSP\_Imports.razor"
using Microsoft.AspNetCore.Components.Forms;

#line default
#line hidden
#nullable disable
#nullable restore
#line 5 "C:\Users\Nguyen Bui\source\repos\FPLSP3\FPLSP\_Imports.razor"
using Microsoft.AspNetCore.Components.Routing;

#line default
#line hidden
#nullable disable
#nullable restore
#line 6 "C:\Users\Nguyen Bui\source\repos\FPLSP3\FPLSP\_Imports.razor"
using Microsoft.AspNetCore.Components.Web;

#line default
#line hidden
#nullable disable
#nullable restore
#line 7 "C:\Users\Nguyen Bui\source\repos\FPLSP3\FPLSP\_Imports.razor"
using Microsoft.AspNetCore.Components.Web.Virtualization;

#line default
#line hidden
#nullable disable
#nullable restore
#line 8 "C:\Users\Nguyen Bui\source\repos\FPLSP3\FPLSP\_Imports.razor"
using Microsoft.JSInterop;

#line default
#line hidden
#nullable disable
#nullable restore
#line 9 "C:\Users\Nguyen Bui\source\repos\FPLSP3\FPLSP\_Imports.razor"
using FPLSP;

#line default
#line hidden
#nullable disable
#nullable restore
#line 10 "C:\Users\Nguyen Bui\source\repos\FPLSP3\FPLSP\_Imports.razor"
using FPLSP.Shared;

#line default
#line hidden
#nullable disable
#nullable restore
#line 11 "C:\Users\Nguyen Bui\source\repos\FPLSP3\FPLSP\_Imports.razor"
using MudBlazor;

#line default
#line hidden
#nullable disable
#nullable restore
#line 12 "C:\Users\Nguyen Bui\source\repos\FPLSP3\FPLSP\_Imports.razor"
using FPLSP.Components;

#line default
#line hidden
#nullable disable
#nullable restore
#line 13 "C:\Users\Nguyen Bui\source\repos\FPLSP3\FPLSP\_Imports.razor"
using Blazored.Typeahead;

#line default
#line hidden
#nullable disable
#nullable restore
#line 14 "C:\Users\Nguyen Bui\source\repos\FPLSP3\FPLSP\_Imports.razor"
using CurrieTechnologies.Razor.SweetAlert2;

#line default
#line hidden
#nullable disable
#nullable restore
#line 2 "C:\Users\Nguyen Bui\source\repos\FPLSP3\FPLSP\Pages\UserManagerPages\DetailUserIdentity.razor"
using Blazored.LocalStorage;

#line default
#line hidden
#nullable disable
#nullable restore
#line 3 "C:\Users\Nguyen Bui\source\repos\FPLSP3\FPLSP\Pages\UserManagerPages\DetailUserIdentity.razor"
using Blazored.Toast.Services;

#line default
#line hidden
#nullable disable
#nullable restore
#line 4 "C:\Users\Nguyen Bui\source\repos\FPLSP3\FPLSP\Pages\UserManagerPages\DetailUserIdentity.razor"
using FPLSP.Data;

#line default
#line hidden
#nullable disable
#nullable restore
#line 5 "C:\Users\Nguyen Bui\source\repos\FPLSP3\FPLSP\Pages\UserManagerPages\DetailUserIdentity.razor"
using FPLSP.Data.Securities;

#line default
#line hidden
#nullable disable
#nullable restore
#line 6 "C:\Users\Nguyen Bui\source\repos\FPLSP3\FPLSP\Pages\UserManagerPages\DetailUserIdentity.razor"
using FPLSP.Repositories.Interfaces;

#line default
#line hidden
#nullable disable
#nullable restore
#line 7 "C:\Users\Nguyen Bui\source\repos\FPLSP3\FPLSP\Pages\UserManagerPages\DetailUserIdentity.razor"
using FPLSP.Server.Domain.Dtos.StudentUPDtos;

#line default
#line hidden
#nullable disable
#nullable restore
#line 8 "C:\Users\Nguyen Bui\source\repos\FPLSP3\FPLSP\Pages\UserManagerPages\DetailUserIdentity.razor"
using FPLSP.Server.Domain.Entities.CoresParts;

#line default
#line hidden
#nullable disable
#nullable restore
#line 9 "C:\Users\Nguyen Bui\source\repos\FPLSP3\FPLSP\Pages\UserManagerPages\DetailUserIdentity.razor"
using FPLSP.Server.Infrastructure.ViewModels;

#line default
#line hidden
#nullable disable
#nullable restore
#line 10 "C:\Users\Nguyen Bui\source\repos\FPLSP3\FPLSP\Pages\UserManagerPages\DetailUserIdentity.razor"
using FPLSP.Server.Infrastructure.ViewModels.LecturerCPVm;

#line default
#line hidden
#nullable disable
#nullable restore
#line 11 "C:\Users\Nguyen Bui\source\repos\FPLSP3\FPLSP\Pages\UserManagerPages\DetailUserIdentity.razor"
using Microsoft.AspNetCore.Identity;

#line default
#line hidden
#nullable disable
#nullable restore
#line 12 "C:\Users\Nguyen Bui\source\repos\FPLSP3\FPLSP\Pages\UserManagerPages\DetailUserIdentity.razor"
using System.Security.Claims;

#line default
#line hidden
#nullable disable
#nullable restore
#line 13 "C:\Users\Nguyen Bui\source\repos\FPLSP3\FPLSP\Pages\UserManagerPages\DetailUserIdentity.razor"
using System.Text.RegularExpressions;

#line default
#line hidden
#nullable disable
#nullable restore
#line 14 "C:\Users\Nguyen Bui\source\repos\FPLSP3\FPLSP\Pages\UserManagerPages\DetailUserIdentity.razor"
           [Authorize(Roles = "AdminCore,AdminCS,LecturerFPLSP")]

#line default
#line hidden
#nullable disable
    [global::Microsoft.AspNetCore.Components.RouteAttribute("/detailuser/{GetIdNonDecrpyt}/{maxlevelNonDecrpyt}/{IdCoSoNonDecrpyt}")]
    public partial class DetailUserIdentity : global::Microsoft.AspNetCore.Components.ComponentBase
    {
        #pragma warning disable 1998
        protected override void BuildRenderTree(global::Microsoft.AspNetCore.Components.Rendering.RenderTreeBuilder __builder)
        {
#nullable restore
#line 16 "C:\Users\Nguyen Bui\source\repos\FPLSP3\FPLSP\Pages\UserManagerPages\DetailUserIdentity.razor"
 if (_lstTrain != null && _lstRole != null)
{

#line default
#line hidden
#nullable disable
            __builder.OpenElement(0, "a");
            __builder.AddAttribute(1, "class", "btn btn-outline-danger");
            __builder.AddAttribute(2, "href", "/listuseriden/" + (
#nullable restore
#line 18 "C:\Users\Nguyen Bui\source\repos\FPLSP3\FPLSP\Pages\UserManagerPages\DetailUserIdentity.razor"
                                                           _cryptoServices.Encrypt(maxlevel.ToString().Replace("/", "I0H" ))

#line default
#line hidden
#nullable disable
            ) + "/" + (
#nullable restore
#line 18 "C:\Users\Nguyen Bui\source\repos\FPLSP3\FPLSP\Pages\UserManagerPages\DetailUserIdentity.razor"
                                                                                                                              _cryptoServices.Encrypt(IdCoSo.ToString().Replace("/", "I0H" ))

#line default
#line hidden
#nullable disable
            ));
            __builder.AddMarkupContent(3, "Quay Lại");
            __builder.CloseElement();
            __builder.AddMarkupContent(4, "\r\n    ");
            __builder.OpenElement(5, "div");
            __builder.AddAttribute(6, "class", "row d-flex justify-content-center");
            __builder.OpenElement(7, "div");
            __builder.AddAttribute(8, "class", "col-md-8");
            __builder.AddMarkupContent(9, "<div></div>\r\n            ");
            __builder.OpenElement(10, "h5");
            __builder.AddAttribute(11, "class", "fw-bold");
            __builder.AddMarkupContent(12, "Chọn Các Quyền Gán Cho :");
            __builder.OpenElement(13, "strong");
#nullable restore
#line (25,66)-(25,80) 25 "C:\Users\Nguyen Bui\source\repos\FPLSP3\FPLSP\Pages\UserManagerPages\DetailUserIdentity.razor"
__builder.AddContent(14, _User.UserName);

#line default
#line hidden
#nullable disable
            __builder.CloseElement();
            __builder.CloseElement();
            __builder.AddMarkupContent(15, "\r\n            ");
            __builder.OpenComponent<global::MudBlazor.MudChipSet>(16);
            __builder.AddAttribute(17, "AllClosable", global::Microsoft.AspNetCore.Components.CompilerServices.RuntimeHelpers.TypeCheck<global::System.Boolean>(
#nullable restore
#line 26 "C:\Users\Nguyen Bui\source\repos\FPLSP3\FPLSP\Pages\UserManagerPages\DetailUserIdentity.razor"
                                     true

#line default
#line hidden
#nullable disable
            ));
            __builder.AddAttribute(18, "OnClose", global::Microsoft.AspNetCore.Components.CompilerServices.RuntimeHelpers.TypeCheck<global::Microsoft.AspNetCore.Components.EventCallback<global::MudBlazor.MudChip>>(global::Microsoft.AspNetCore.Components.EventCallback.Factory.Create<global::MudBlazor.MudChip>(this, 
#nullable restore
#line 26 "C:\Users\Nguyen Bui\source\repos\FPLSP3\FPLSP\Pages\UserManagerPages\DetailUserIdentity.razor"
                                                    Closed

#line default
#line hidden
#nullable disable
            )));
            __builder.AddAttribute(19, "ChildContent", (global::Microsoft.AspNetCore.Components.RenderFragment)((__builder2) => {
#nullable restore
#line 28 "C:\Users\Nguyen Bui\source\repos\FPLSP3\FPLSP\Pages\UserManagerPages\DetailUserIdentity.razor"
                 foreach (var x in @_User.ListRoles)
                {

#line default
#line hidden
#nullable disable
                __builder2.OpenComponent<global::MudBlazor.MudChip>(20);
                __builder2.AddAttribute(21, "Text", global::Microsoft.AspNetCore.Components.CompilerServices.RuntimeHelpers.TypeCheck<global::System.String>(
#nullable restore
#line 30 "C:\Users\Nguyen Bui\source\repos\FPLSP3\FPLSP\Pages\UserManagerPages\DetailUserIdentity.razor"
                                    x

#line default
#line hidden
#nullable disable
                ));
                __builder2.CloseComponent();
#nullable restore
#line 31 "C:\Users\Nguyen Bui\source\repos\FPLSP3\FPLSP\Pages\UserManagerPages\DetailUserIdentity.razor"
                }

#line default
#line hidden
#nullable disable
            }
            ));
            __builder.CloseComponent();
            __builder.AddMarkupContent(22, "\r\n            <hr>\r\n            ");
            __builder.OpenElement(23, "div");
            __builder.AddAttribute(24, "class", "mb-3");
            __builder.AddMarkupContent(25, "<label for=\"exampleFormControlInput3\" class=\"form-label px-lg-0\">Chọn quyền :</label>");
#nullable restore
#line 39 "C:\Users\Nguyen Bui\source\repos\FPLSP3\FPLSP\Pages\UserManagerPages\DetailUserIdentity.razor"
                 foreach (var x in _lstRole)
                {

#line default
#line hidden
#nullable disable
            __builder.OpenComponent<global::MudBlazor.MudButton>(26);
            __builder.AddAttribute(27, "OnClick", global::Microsoft.AspNetCore.Components.CompilerServices.RuntimeHelpers.TypeCheck<global::Microsoft.AspNetCore.Components.EventCallback<global::Microsoft.AspNetCore.Components.Web.MouseEventArgs>>(global::Microsoft.AspNetCore.Components.EventCallback.Factory.Create<global::Microsoft.AspNetCore.Components.Web.MouseEventArgs>(this, 
#nullable restore
#line 41 "C:\Users\Nguyen Bui\source\repos\FPLSP3\FPLSP\Pages\UserManagerPages\DetailUserIdentity.razor"
                                        ()=>Add(x.Name)

#line default
#line hidden
#nullable disable
            )));
            __builder.AddAttribute(28, "ChildContent", (global::Microsoft.AspNetCore.Components.RenderFragment)((__builder2) => {
                __builder2.OpenElement(29, "span");
                __builder2.AddAttribute(30, "class", "px-2");
#nullable restore
#line (41,78)-(41,84) 26 "C:\Users\Nguyen Bui\source\repos\FPLSP3\FPLSP\Pages\UserManagerPages\DetailUserIdentity.razor"
__builder2.AddContent(31, x.Name);

#line default
#line hidden
#nullable disable
                __builder2.CloseElement();
            }
            ));
            __builder.CloseComponent();
#nullable restore
#line 42 "C:\Users\Nguyen Bui\source\repos\FPLSP3\FPLSP\Pages\UserManagerPages\DetailUserIdentity.razor"
                }

#line default
#line hidden
#nullable disable
            __builder.CloseElement();
#nullable restore
#line 46 "C:\Users\Nguyen Bui\source\repos\FPLSP3\FPLSP\Pages\UserManagerPages\DetailUserIdentity.razor"
             if (_User.ListRoles.ToList().Any(c => c != "AdminCore"))
            {

#line default
#line hidden
#nullable disable
            __builder.OpenElement(32, "h5");
            __builder.AddAttribute(33, "class", "fw-bold");
            __builder.AddMarkupContent(34, "Chọn Cơ Sở Cho : ");
            __builder.OpenElement(35, "strong");
#nullable restore
#line (48,63)-(48,77) 25 "C:\Users\Nguyen Bui\source\repos\FPLSP3\FPLSP\Pages\UserManagerPages\DetailUserIdentity.razor"
__builder.AddContent(36, _User.UserName);

#line default
#line hidden
#nullable disable
            __builder.CloseElement();
            __builder.CloseElement();
            __builder.AddMarkupContent(37, "\r\n                ");
            __builder.OpenComponent<global::MudBlazor.MudChipSet>(38);
            __builder.AddAttribute(39, "ChildContent", (global::Microsoft.AspNetCore.Components.RenderFragment)((__builder2) => {
                __builder2.AddMarkupContent(40, "<span>Cơ sở hiện tại: </span>\r\n                    ");
                __builder2.OpenComponent<global::MudBlazor.MudChip>(41);
                __builder2.AddAttribute(42, "Text", global::Microsoft.AspNetCore.Components.CompilerServices.RuntimeHelpers.TypeCheck<global::System.String>(
#nullable restore
#line 51 "C:\Users\Nguyen Bui\source\repos\FPLSP3\FPLSP\Pages\UserManagerPages\DetailUserIdentity.razor"
                                    _lstTrain.Where(c => c.Id == _User.IdTrainingFacility).Select(c => c.TrainingInstitutionName).FirstOrDefault()

#line default
#line hidden
#nullable disable
                ));
                __builder2.CloseComponent();
            }
            ));
            __builder.CloseComponent();
            __builder.AddMarkupContent(43, "\r\n                <hr>\r\n                ");
            __builder.OpenElement(44, "div");
            __builder.AddAttribute(45, "class", "mb-3");
            __builder.AddMarkupContent(46, "<label for=\"exampleFormControlInput3\" class=\"form-label px-lg-0\">Chọn cơ sở :</label>");
#nullable restore
#line 57 "C:\Users\Nguyen Bui\source\repos\FPLSP3\FPLSP\Pages\UserManagerPages\DetailUserIdentity.razor"
                     foreach (var x in _lstTrain)
                    {

#line default
#line hidden
#nullable disable
            __builder.OpenComponent<global::MudBlazor.MudButton>(47);
            __builder.AddAttribute(48, "Style", "hover:grey;");
            __builder.AddAttribute(49, "OnClick", global::Microsoft.AspNetCore.Components.CompilerServices.RuntimeHelpers.TypeCheck<global::Microsoft.AspNetCore.Components.EventCallback<global::Microsoft.AspNetCore.Components.Web.MouseEventArgs>>(global::Microsoft.AspNetCore.Components.EventCallback.Factory.Create<global::Microsoft.AspNetCore.Components.Web.MouseEventArgs>(this, 
#nullable restore
#line 59 "C:\Users\Nguyen Bui\source\repos\FPLSP3\FPLSP\Pages\UserManagerPages\DetailUserIdentity.razor"
                                                                ()=>AddTrain(x.Id)

#line default
#line hidden
#nullable disable
            )));
            __builder.AddAttribute(50, "ChildContent", (global::Microsoft.AspNetCore.Components.RenderFragment)((__builder2) => {
                __builder2.OpenElement(51, "span");
                __builder2.AddAttribute(52, "class", "px-2");
#nullable restore
#line (59,105)-(59,130) 26 "C:\Users\Nguyen Bui\source\repos\FPLSP3\FPLSP\Pages\UserManagerPages\DetailUserIdentity.razor"
__builder2.AddContent(53, x.TrainingInstitutionName);

#line default
#line hidden
#nullable disable
                __builder2.CloseElement();
            }
            ));
            __builder.CloseComponent();
#nullable restore
#line 60 "C:\Users\Nguyen Bui\source\repos\FPLSP3\FPLSP\Pages\UserManagerPages\DetailUserIdentity.razor"
                    }

#line default
#line hidden
#nullable disable
            __builder.CloseElement();
#nullable restore
#line 63 "C:\Users\Nguyen Bui\source\repos\FPLSP3\FPLSP\Pages\UserManagerPages\DetailUserIdentity.razor"
            }
            

#line default
#line hidden
#nullable disable
            __builder.OpenElement(54, "h5");
            __builder.AddAttribute(55, "class", "fw-bold");
            __builder.AddMarkupContent(56, "Chọn Điều Hướng Cho : ");
            __builder.OpenElement(57, "strong");
#nullable restore
#line (68,64)-(68,78) 25 "C:\Users\Nguyen Bui\source\repos\FPLSP3\FPLSP\Pages\UserManagerPages\DetailUserIdentity.razor"
__builder.AddContent(58, _User.UserName);

#line default
#line hidden
#nullable disable
            __builder.CloseElement();
            __builder.CloseElement();
            __builder.AddMarkupContent(59, "\r\n            ");
            __builder.OpenComponent<global::MudBlazor.MudChipSet>(60);
            __builder.AddAttribute(61, "AllClosable", global::Microsoft.AspNetCore.Components.CompilerServices.RuntimeHelpers.TypeCheck<global::System.Boolean>(
#nullable restore
#line 69 "C:\Users\Nguyen Bui\source\repos\FPLSP3\FPLSP\Pages\UserManagerPages\DetailUserIdentity.razor"
                                     true

#line default
#line hidden
#nullable disable
            ));
            __builder.AddAttribute(62, "OnClose", global::Microsoft.AspNetCore.Components.CompilerServices.RuntimeHelpers.TypeCheck<global::Microsoft.AspNetCore.Components.EventCallback<global::MudBlazor.MudChip>>(global::Microsoft.AspNetCore.Components.EventCallback.Factory.Create<global::MudBlazor.MudChip>(this, 
#nullable restore
#line 69 "C:\Users\Nguyen Bui\source\repos\FPLSP3\FPLSP\Pages\UserManagerPages\DetailUserIdentity.razor"
                                                    RemoveReDirect

#line default
#line hidden
#nullable disable
            )));
            __builder.AddAttribute(63, "ChildContent", (global::Microsoft.AspNetCore.Components.RenderFragment)((__builder2) => {
#nullable restore
#line 71 "C:\Users\Nguyen Bui\source\repos\FPLSP3\FPLSP\Pages\UserManagerPages\DetailUserIdentity.razor"
                 foreach (var re in _User.ListRedirectClaims)
                {

                    if (_User.ListRedirectClaims.Where(c => c.Value == "true").Count() == 2)
                    {

                        if (_User.ListRedirectClaims.Any(c => c.Type == fpl))
                        {

#line default
#line hidden
#nullable disable
                __builder2.OpenComponent<global::MudBlazor.MudChip>(64);
                __builder2.AddAttribute(65, "Value", global::Microsoft.AspNetCore.Components.CompilerServices.RuntimeHelpers.TypeCheck<global::System.Object>(
#nullable restore
#line 79 "C:\Users\Nguyen Bui\source\repos\FPLSP3\FPLSP\Pages\UserManagerPages\DetailUserIdentity.razor"
                                            (_User.ListRedirectClaims.Find(c=>c.Type==fpl))

#line default
#line hidden
#nullable disable
                ));
                __builder2.AddAttribute(66, "ChildContent", (global::Microsoft.AspNetCore.Components.RenderFragment)((__builder3) => {
                    __builder3.AddContent(67, "FPLSP Support");
                }
                ));
                __builder2.CloseComponent();
#nullable restore
#line 80 "C:\Users\Nguyen Bui\source\repos\FPLSP3\FPLSP\Pages\UserManagerPages\DetailUserIdentity.razor"
                        }
                        if (_User.ListRedirectClaims.Any(c => c.Type == cabin))
                        {

#line default
#line hidden
#nullable disable
                __builder2.OpenComponent<global::MudBlazor.MudChip>(68);
                __builder2.AddAttribute(69, "Value", global::Microsoft.AspNetCore.Components.CompilerServices.RuntimeHelpers.TypeCheck<global::System.Object>(
#nullable restore
#line 83 "C:\Users\Nguyen Bui\source\repos\FPLSP3\FPLSP\Pages\UserManagerPages\DetailUserIdentity.razor"
                                            (_User.ListRedirectClaims.Find(c=>c.Type==cabin))

#line default
#line hidden
#nullable disable
                ));
                __builder2.AddAttribute(70, "ChildContent", (global::Microsoft.AspNetCore.Components.RenderFragment)((__builder3) => {
                    __builder3.AddContent(71, "Cabin Project");
                }
                ));
                __builder2.CloseComponent();
#nullable restore
#line 84 "C:\Users\Nguyen Bui\source\repos\FPLSP3\FPLSP\Pages\UserManagerPages\DetailUserIdentity.razor"
                        }
                        if (_User.ListRedirectClaims.Any(c => c.Type == exam))
                        {

#line default
#line hidden
#nullable disable
                __builder2.OpenComponent<global::MudBlazor.MudChip>(72);
                __builder2.AddAttribute(73, "Value", global::Microsoft.AspNetCore.Components.CompilerServices.RuntimeHelpers.TypeCheck<global::System.Object>(
#nullable restore
#line 87 "C:\Users\Nguyen Bui\source\repos\FPLSP3\FPLSP\Pages\UserManagerPages\DetailUserIdentity.razor"
                                            (_User.ListRedirectClaims.Find(c=>c.Type==exam))

#line default
#line hidden
#nullable disable
                ));
                __builder2.AddAttribute(74, "ChildContent", (global::Microsoft.AspNetCore.Components.RenderFragment)((__builder3) => {
                    __builder3.AddContent(75, "Exam Project");
                }
                ));
                __builder2.CloseComponent();
#nullable restore
#line 88 "C:\Users\Nguyen Bui\source\repos\FPLSP3\FPLSP\Pages\UserManagerPages\DetailUserIdentity.razor"
                        }

                        break;
                    }
                    if (re.Type == "CanViewFPLSPProject")
                    {

#line default
#line hidden
#nullable disable
                __builder2.OpenComponent<global::MudBlazor.MudChip>(76);
                __builder2.AddAttribute(77, "Value", global::Microsoft.AspNetCore.Components.CompilerServices.RuntimeHelpers.TypeCheck<global::System.Object>(
#nullable restore
#line 94 "C:\Users\Nguyen Bui\source\repos\FPLSP3\FPLSP\Pages\UserManagerPages\DetailUserIdentity.razor"
                                        (_User.ListRedirectClaims.Find(c=>c.Type==fpl))

#line default
#line hidden
#nullable disable
                ));
                __builder2.AddAttribute(78, "ChildContent", (global::Microsoft.AspNetCore.Components.RenderFragment)((__builder3) => {
                    __builder3.AddContent(79, "FPLSP Support");
                }
                ));
                __builder2.CloseComponent();
#nullable restore
#line 95 "C:\Users\Nguyen Bui\source\repos\FPLSP3\FPLSP\Pages\UserManagerPages\DetailUserIdentity.razor"
                    }
                    if (re.Type == "CanViewCabinProject")
                    {

#line default
#line hidden
#nullable disable
                __builder2.OpenComponent<global::MudBlazor.MudChip>(80);
                __builder2.AddAttribute(81, "Value", global::Microsoft.AspNetCore.Components.CompilerServices.RuntimeHelpers.TypeCheck<global::System.Object>(
#nullable restore
#line 98 "C:\Users\Nguyen Bui\source\repos\FPLSP3\FPLSP\Pages\UserManagerPages\DetailUserIdentity.razor"
                                        (_User.ListRedirectClaims.Find(c=>c.Type==cabin))

#line default
#line hidden
#nullable disable
                ));
                __builder2.AddAttribute(82, "ChildContent", (global::Microsoft.AspNetCore.Components.RenderFragment)((__builder3) => {
                    __builder3.AddContent(83, "Cabin Project");
                }
                ));
                __builder2.CloseComponent();
#nullable restore
#line 99 "C:\Users\Nguyen Bui\source\repos\FPLSP3\FPLSP\Pages\UserManagerPages\DetailUserIdentity.razor"
                    }
                    if (re.Type == "CanViewFPLExam")
                    {

#line default
#line hidden
#nullable disable
                __builder2.OpenComponent<global::MudBlazor.MudChip>(84);
                __builder2.AddAttribute(85, "Value", global::Microsoft.AspNetCore.Components.CompilerServices.RuntimeHelpers.TypeCheck<global::System.Object>(
#nullable restore
#line 102 "C:\Users\Nguyen Bui\source\repos\FPLSP3\FPLSP\Pages\UserManagerPages\DetailUserIdentity.razor"
                                        (_User.ListRedirectClaims.Find(c=>c.Type==exam))

#line default
#line hidden
#nullable disable
                ));
                __builder2.AddAttribute(86, "ChildContent", (global::Microsoft.AspNetCore.Components.RenderFragment)((__builder3) => {
                    __builder3.AddContent(87, "Exam Project");
                }
                ));
                __builder2.CloseComponent();
#nullable restore
#line 103 "C:\Users\Nguyen Bui\source\repos\FPLSP3\FPLSP\Pages\UserManagerPages\DetailUserIdentity.razor"
                    }
                }

#line default
#line hidden
#nullable disable
            }
            ));
            __builder.CloseComponent();
            __builder.AddMarkupContent(88, "\r\n            <hr>\r\n            ");
            __builder.OpenElement(89, "div");
            __builder.AddAttribute(90, "class", "mb-3");
            __builder.AddMarkupContent(91, "<label for=\"exampleFormControlInput3\" class=\"form-label px-lg-0\">Chọn Điều Hướng :</label>\r\n\r\n                ");
            __builder.OpenComponent<global::MudBlazor.MudButton>(92);
            __builder.AddAttribute(93, "Style", "hover:grey;");
            __builder.AddAttribute(94, "OnClick", global::Microsoft.AspNetCore.Components.CompilerServices.RuntimeHelpers.TypeCheck<global::Microsoft.AspNetCore.Components.EventCallback<global::Microsoft.AspNetCore.Components.Web.MouseEventArgs>>(global::Microsoft.AspNetCore.Components.EventCallback.Factory.Create<global::Microsoft.AspNetCore.Components.Web.MouseEventArgs>(this, 
#nullable restore
#line 112 "C:\Users\Nguyen Bui\source\repos\FPLSP3\FPLSP\Pages\UserManagerPages\DetailUserIdentity.razor"
                                                        ()=>AddRedirect(_lstRedirect.Find(c=>c.Type==fpl))

#line default
#line hidden
#nullable disable
            )));
            __builder.AddAttribute(95, "ChildContent", (global::Microsoft.AspNetCore.Components.RenderFragment)((__builder2) => {
                __builder2.AddMarkupContent(96, "<span class=\"px-2\">FPLSP Support</span>");
            }
            ));
            __builder.CloseComponent();
            __builder.AddMarkupContent(97, "\r\n\r\n\r\n                ");
            __builder.OpenComponent<global::MudBlazor.MudButton>(98);
            __builder.AddAttribute(99, "Style", "hover:grey;");
            __builder.AddAttribute(100, "OnClick", global::Microsoft.AspNetCore.Components.CompilerServices.RuntimeHelpers.TypeCheck<global::Microsoft.AspNetCore.Components.EventCallback<global::Microsoft.AspNetCore.Components.Web.MouseEventArgs>>(global::Microsoft.AspNetCore.Components.EventCallback.Factory.Create<global::Microsoft.AspNetCore.Components.Web.MouseEventArgs>(this, 
#nullable restore
#line 115 "C:\Users\Nguyen Bui\source\repos\FPLSP3\FPLSP\Pages\UserManagerPages\DetailUserIdentity.razor"
                                                        ()=>AddRedirect(_lstRedirect.Find(c=>c.Type==cabin))

#line default
#line hidden
#nullable disable
            )));
            __builder.AddAttribute(101, "ChildContent", (global::Microsoft.AspNetCore.Components.RenderFragment)((__builder2) => {
                __builder2.AddMarkupContent(102, "<span class=\"px-2\">Cabin Project</span>");
            }
            ));
            __builder.CloseComponent();
            __builder.AddMarkupContent(103, "\r\n\r\n                ");
            __builder.OpenComponent<global::MudBlazor.MudButton>(104);
            __builder.AddAttribute(105, "Style", "hover:grey;");
            __builder.AddAttribute(106, "OnClick", global::Microsoft.AspNetCore.Components.CompilerServices.RuntimeHelpers.TypeCheck<global::Microsoft.AspNetCore.Components.EventCallback<global::Microsoft.AspNetCore.Components.Web.MouseEventArgs>>(global::Microsoft.AspNetCore.Components.EventCallback.Factory.Create<global::Microsoft.AspNetCore.Components.Web.MouseEventArgs>(this, 
#nullable restore
#line 117 "C:\Users\Nguyen Bui\source\repos\FPLSP3\FPLSP\Pages\UserManagerPages\DetailUserIdentity.razor"
                                                        ()=>AddRedirect(_lstRedirect.Find(c=>c.Type==exam))

#line default
#line hidden
#nullable disable
            )));
            __builder.AddAttribute(107, "ChildContent", (global::Microsoft.AspNetCore.Components.RenderFragment)((__builder2) => {
                __builder2.AddMarkupContent(108, "<span class=\"px-2\">Exam Project</span>");
            }
            ));
            __builder.CloseComponent();
            __builder.CloseElement();
            __builder.CloseElement();
            __builder.AddMarkupContent(109, "\r\n        ");
            __builder.OpenElement(110, "div");
            __builder.AddAttribute(111, "class", "row d-flex justify-content-center");
            __builder.OpenElement(112, "button");
            __builder.AddAttribute(113, "class", "btn btn-warning col-lg-6");
            __builder.AddAttribute(114, "onclick", global::Microsoft.AspNetCore.Components.EventCallback.Factory.Create<global::Microsoft.AspNetCore.Components.Web.MouseEventArgs>(this, 
#nullable restore
#line 124 "C:\Users\Nguyen Bui\source\repos\FPLSP3\FPLSP\Pages\UserManagerPages\DetailUserIdentity.razor"
                                                              AddRoleToUser

#line default
#line hidden
#nullable disable
            ));
            __builder.AddMarkupContent(115, "Cấp quyền");
            __builder.CloseElement();
            __builder.CloseElement();
            __builder.CloseElement();
#nullable restore
#line 127 "C:\Users\Nguyen Bui\source\repos\FPLSP3\FPLSP\Pages\UserManagerPages\DetailUserIdentity.razor"
}
else
{

#line default
#line hidden
#nullable disable
            __builder.OpenComponent<global::FPLSP.Components.LoadingIndicator>(116);
            __builder.CloseComponent();
#nullable restore
#line 131 "C:\Users\Nguyen Bui\source\repos\FPLSP3\FPLSP\Pages\UserManagerPages\DetailUserIdentity.razor"
}

#line default
#line hidden
#nullable disable
            __builder.OpenComponent<global::FPLSP.Components.Comfirmation>(117);
            __builder.AddAttribute(118, "ConfirmationMessage", "Khi đổi cơ sở sẽ bị xóa hết dự liệu ở cơ sở cũ ban chắc chắc chứ?");
            __builder.AddAttribute(119, "ConfirmationTitle", "Xóa dữ liệu");
            __builder.AddAttribute(120, "ConfirmationChanged", global::Microsoft.AspNetCore.Components.CompilerServices.RuntimeHelpers.TypeCheck<global::Microsoft.AspNetCore.Components.EventCallback<global::System.Boolean>>(global::Microsoft.AspNetCore.Components.EventCallback.Factory.Create<global::System.Boolean>(this, 
#nullable restore
#line 135 "C:\Users\Nguyen Bui\source\repos\FPLSP3\FPLSP\Pages\UserManagerPages\DetailUserIdentity.razor"
                                                    OnConfirmationDelete

#line default
#line hidden
#nullable disable
            )));
            __builder.AddComponentReferenceCapture(121, (__value) => {
#nullable restore
#line 134 "C:\Users\Nguyen Bui\source\repos\FPLSP3\FPLSP\Pages\UserManagerPages\DetailUserIdentity.razor"
                                     DeleteConfirmation = (FPLSP.Components.Comfirmation)__value;

#line default
#line hidden
#nullable disable
            }
            );
            __builder.CloseComponent();
            __builder.AddMarkupContent(122, "\r\n");
            __builder.OpenComponent<global::FPLSP.Components.Comfirmation>(123);
            __builder.AddAttribute(124, "ConfirmationMessage", "Khi xóa quyền hiện có sẽ bị xóa hết dự liệu ở quyền đó ban chắc chắc chứ?");
            __builder.AddAttribute(125, "ConfirmationTitle", "Xóa dữ liệu");
            __builder.AddAttribute(126, "ConfirmationChanged", global::Microsoft.AspNetCore.Components.CompilerServices.RuntimeHelpers.TypeCheck<global::Microsoft.AspNetCore.Components.EventCallback<global::System.Boolean>>(global::Microsoft.AspNetCore.Components.EventCallback.Factory.Create<global::System.Boolean>(this, 
#nullable restore
#line 139 "C:\Users\Nguyen Bui\source\repos\FPLSP3\FPLSP\Pages\UserManagerPages\DetailUserIdentity.razor"
                                                    OnConfirmationDeleteUser

#line default
#line hidden
#nullable disable
            )));
            __builder.AddComponentReferenceCapture(127, (__value) => {
#nullable restore
#line 138 "C:\Users\Nguyen Bui\source\repos\FPLSP3\FPLSP\Pages\UserManagerPages\DetailUserIdentity.razor"
                                     DeleteConfirmationUser = (FPLSP.Components.Comfirmation)__value;

#line default
#line hidden
#nullable disable
            }
            );
            __builder.CloseComponent();
        }
        #pragma warning restore 1998
#nullable restore
#line 142 "C:\Users\Nguyen Bui\source\repos\FPLSP3\FPLSP\Pages\UserManagerPages\DetailUserIdentity.razor"
 
    string fpl = "CanViewFPLSPProject";
    string cabin = "CanViewCabinProject";
    string exam = "CanViewFPLExam";
    string checker = "true";
    [Inject] public IUserIdentityRepo _UserIdentityRepo { get; set; }
    [Inject] public IToastService _toastService { get; set; }
    [Inject] public ITrainingFacilitiesCPRepo _trainingFacilitiesCPRepo { get; set; }
    [Inject] public IStudentUPRepo _studentUPRepo { get; set; }
    private UserInListRoles _User;
    private UserInListRoles _UserFlag;
    [Inject]
    public IRoleUserIdentityRepo _roleUserIdentityRepo { get; set; }
    [Inject] public ILecturersCPRepo _lecturersCPRepo { get; set; }
    private List<IdentityRole> _lstRole { get; set; }
    private List<TrainingFacilitiesCP> _lstTrain = new List<TrainingFacilitiesCP>();
    private TrainingFacilitiesCP _Train = new TrainingFacilitiesCP();
    private IdentityRole _role;
    [Inject] public NavigationManager Navigation { get; set; }
    [Inject] public IToastService toastService { get; set; }
    protected Comfirmation DeleteConfirmation { get; set; }
    protected Comfirmation DeleteConfirmationUser { get; set; }
    Guid idTrainFlag;
    [Parameter]
    public string GetIdNonDecrpyt { get; set; }
    public string GetId = "";

    public string email { get; set; }
    public bool check { get; set; } = false;
    [Parameter]
    public string maxlevelNonDecrpyt { get; set; }
    public string maxlevel = "";
    [Parameter]
    public string IdCoSoNonDecrpyt { get; set; }
    public string IdCoSo = "";
    //tạo ra 1 list claim redriect
    private List<Claim> _lstRedirect = new List<Claim>();
    [Inject] public UserManager<UserSignIn> _userManager { get; set; }
    

    [Inject]
    public CryptoServices _cryptoServices { get; set; }
    public DetailUserIdentity()
    {

        _User = new UserInListRoles();
        _role = new IdentityRole();
    }
    bool flagReturn = false;
   
    public async Task OnConfirmationDelete(bool confirmed)
    {
        if (confirmed)
        {
          
            await _UserIdentityRepo.CheckUserChageIdTrain(_User.Id, _User.IdTrainingFacility);
            UserUpdateRolesHasClaims userUpdateRoles = new UserUpdateRolesHasClaims()
                {
                    ID = GetId,
                    Name = _User.UserName,
                    claims = _User.ListRedirectClaims,
                    RoleNames = _User.ListRoles.ToArray()
                };

            //Check tồn tại phù hợp với quyền
            if (userUpdateRoles.RoleNames.Any(c => c == "GV FPLExam") || userUpdateRoles.RoleNames.Any(c => c == "LecturerFPLSP"))
            {
                var lstLeture = await _lecturersCPRepo.GetLecturerMapper();
                lstLeture = lstLeture.Where(c => c.LecturersCode.Contains("GV")).ToList();
                if (lstLeture.Any(c => c.Id == Guid.Parse(_User.Id)))
                {
                    var lectureCP = lstLeture.Find(c => c.Id == Guid.Parse(_User.Id));
                    lectureCP.IsDeleted = false;

                    await _lecturersCPRepo.UpdateLectureCP(lectureCP);
                }
                else
                {
                    var createLeture = new CreateleatureForTrainVm()
                        {
                            Email = _User.Email,
                            IdTrain = _User.IdTrainingFacility,
                            Id = Guid.Parse(_User.Id)

                        };
                    await _lecturersCPRepo.CreateLecturerForTrain(createLeture);
                }

            }
            if (userUpdateRoles.RoleNames.Any(c => c == "Student"))
            {
                var lstStudent = await _studentUPRepo.GetAllStudentDtosAsync();

                var a = lstStudent.FirstOrDefault(c => c.Id == Guid.Parse(_User.Id));
                if (lstStudent.Any(c => c.Id == Guid.Parse(_User.Id)))
                {
                    var studentUP = lstStudent.Find(c => c.Id == Guid.Parse(_User.Id));
                    var update = new FPLSP.Server.Infrastructure.ViewModels.StudentsUPVm.StudentUpdateVM()
                        {
                            Email = studentUP.Email,
                            Ethnic = studentUP.Ethnic,
                            Address = studentUP.Address,
                            DateOfBirth = studentUP.DateOfBirth,
                            Description = studentUP.Description,
                            FathersName = studentUP.FathersName,
                            Gender = studentUP.Gender,
                            HomeTown = studentUP.HomeTown,
                            IdentityCardNumber = studentUP.IdentityCardNumber,
                            ImageUrl = studentUP.ImageUrl,
                            IssuedOn = studentUP.IssuedOn,
                            MotherName = studentUP.MotherName,
                            PhoneNumber = studentUP.PhoneNumber,
                            StudentCode = studentUP.StudentCode,
                            StudentName = studentUP.StudentName,
                            Password = studentUP.Password,
                            Status = studentUP.Status,
                            IsDelete = false

                        };

                    await _studentUPRepo.UpdateStudentUP(studentUP.Id, update);



                }
                else
                {

                    var studentgmail = _User.Email.Split("@")[0];
                    var studentCode = studentgmail.Substring(studentgmail.Length - 7).ToUpper();
                    var studentInClassCreate = new StudentUpDto()
                        {
                            Email = _User.Email,
                            Ethnic = "",
                            Address = "",
                            DateOfBirth = DateTime.Now,
                            Description = "",
                            FathersName = "",
                            Gender = true,
                            HomeTown = "",
                            Id = Guid.Parse(_User.Id),
                            IdentityCardNumber = "",
                            ImageUrl = "",
                            IssuedOn = DateTime.Now,
                            MotherName = "",
                            Password = "",
                            PhoneNumber = "",
                            Status = 2,
                            StudentCode = studentCode,
                            StudentName = ""

                        };
                    await _studentUPRepo.CreateStudentUPstudentInClass(studentInClassCreate);
                }
            }
            //kiểm tra xem tất cả role hiện tại sau khi đã thêm hoặc cập nhật role đã có admin core chưa
            if (userUpdateRoles.RoleNames.ToList().Any(c => c != "AdminCore"))
            {


              
                if (_User.IdTrainingFacility != Guid.Empty)
                {
                    //kiểm tra xem cơ sở cũ ở trongdatabase với cơ sở mới vừa chọn có khác nhau hay không
                    var getCurrentUser = await _UserIdentityRepo.GetUserRoleById(GetId);
                    if (getCurrentUser.IdTrainingFacility != _User.IdTrainingFacility)
                    {
                        foreach (var user in _userManager.Users.ToList().Where(c => c.Id == GetId))
                        {
                            user.IdTrainingFacility = _User.IdTrainingFacility;
                            await _userManager.UpdateAsync(user);

                        }
                    }



                    //cập nhật mới lại cho giảng viên
                    if (userUpdateRoles.RoleNames.ToList().Any(c => c == "Lecturer" || c == "LecturerFPLSP"))
                    {
                        var update = new CreateleatureForTrainVm()
                            {
                                Id = Guid.Parse(_User.Id),
                                Email = _User.UserName,
                                IdTrain = _User.IdTrainingFacility
                            };
                        var all = await _lecturersCPRepo.GetAllLecturerAsync();
                        foreach (var x in all.Where(c => c.Email == _User.Email))
                        {
                            x.TrainingFacilitiesId = _User.IdTrainingFacility;
                            await _lecturersCPRepo.UpdateLecturerTrain(x.Id, update);
                        }
                    }
                }
            }

            if (_User.IdTrainingFacility == Guid.Empty)
            {
                _toastService.ShowError("Bạn chưa chọn cơ sở ");
            
                return;
            }
            else
            {
                
                var res = await _UserIdentityRepo.AddRolesToUser(userUpdateRoles);
                if (res)
                {

                    toastService.ShowSuccess($"Cấp quyền thành công cho {_User.UserName}");
                    
                    Navigation.NavigateTo($"/listuseriden/{_cryptoServices.Encrypt(maxlevel.ToString().Replace("/", "I0H"))}/{_cryptoServices.Encrypt(IdCoSo.ToString().Replace("/", "I0H"))}");
                }
                else
                {
                    toastService.ShowError($"Cấp quyền thất bại cho {_User.UserName}");
                    
                    return;
                }
            }
        }
        else
        {
            _User.IdTrainingFacility = idTrainFlag;
            flagChageIDTrain = false;
            
        }

    }

    public async Task OnConfirmationDeleteUser(bool confirmed)
    {
        if (confirmed)
        {
           
            await _UserIdentityRepo.DeleteUserNorRole(_User.Id);
            UserUpdateRolesHasClaims userUpdateRoles = new UserUpdateRolesHasClaims()
                {
                    ID = GetId,
                    Name = _User.UserName,
                    claims = _User.ListRedirectClaims,
                    RoleNames = _User.ListRoles.ToArray()
                };

            //Check tồn tại phù hợp với quyền
            if (userUpdateRoles.RoleNames.Any(c => c == "GV FPLExam") || userUpdateRoles.RoleNames.Any(c => c == "LecturerFPLSP"))
            {
                var lstLeture = await _lecturersCPRepo.GetLecturerMapper();
                lstLeture = lstLeture.Where(c => c.LecturersCode.Contains("GV")).ToList();
                if (lstLeture.Any(c => c.Id == Guid.Parse(_User.Id)))
                {
                    var lectureCP = lstLeture.Find(c => c.Id == Guid.Parse(_User.Id));
                    lectureCP.IsDeleted = false;

                    await _lecturersCPRepo.UpdateLectureCP(lectureCP);
                }
                else
                {
                    var createLeture = new CreateleatureForTrainVm()
                        {
                            Email = _User.Email,
                            IdTrain = _User.IdTrainingFacility,
                            Id = Guid.Parse(_User.Id)

                        };
                    await _lecturersCPRepo.CreateLecturerForTrain(createLeture);
                }

            }
            if (userUpdateRoles.RoleNames.Any(c => c == "Student"))
            {
                var lstStudent = await _studentUPRepo.GetAllStudentDtosAsync();

                var a = lstStudent.FirstOrDefault(c => c.Id == Guid.Parse(_User.Id));
                if (lstStudent.Any(c => c.Id == Guid.Parse(_User.Id)))
                {
                    var studentUP = lstStudent.Find(c => c.Id == Guid.Parse(_User.Id));
                    var update = new FPLSP.Server.Infrastructure.ViewModels.StudentsUPVm.StudentUpdateVM()
                        {
                            Email = studentUP.Email,
                            Ethnic = studentUP.Ethnic,
                            Address = studentUP.Address,
                            DateOfBirth = studentUP.DateOfBirth,
                            Description = studentUP.Description,
                            FathersName = studentUP.FathersName,
                            Gender = studentUP.Gender,
                            HomeTown = studentUP.HomeTown,
                            IdentityCardNumber = studentUP.IdentityCardNumber,
                            ImageUrl = studentUP.ImageUrl,
                            IssuedOn = studentUP.IssuedOn,
                            MotherName = studentUP.MotherName,
                            PhoneNumber = studentUP.PhoneNumber,
                            StudentCode = studentUP.StudentCode,
                            StudentName = studentUP.StudentName,
                            Password = studentUP.Password,
                            Status = studentUP.Status,
                            IsDelete = false

                        };

                    await _studentUPRepo.UpdateStudentUP(studentUP.Id, update);



                }
                else
                {

                    var studentgmail = _User.Email.Split("@")[0];
                    var studentCode = studentgmail.Substring(studentgmail.Length - 7).ToUpper();
                    var studentInClassCreate = new StudentUpDto()
                        {
                            Email = _User.Email,
                            Ethnic = "",
                            Address = "",
                            DateOfBirth = DateTime.Now,
                            Description = "",
                            FathersName = "",
                            Gender = true,
                            HomeTown = "",
                            Id = Guid.Parse(_User.Id),
                            IdentityCardNumber = "",
                            ImageUrl = "",
                            IssuedOn = DateTime.Now,
                            MotherName = "",
                            Password = "",
                            PhoneNumber = "",
                            Status = 2,
                            StudentCode = studentCode,
                            StudentName = ""

                        };
                    await _studentUPRepo.CreateStudentUPstudentInClass(studentInClassCreate);
                }
            }

            //kiểm tra xem tất cả role hiện tại sau khi đã thêm hoặc cập nhật role đã có admin core chưa
            if (userUpdateRoles.RoleNames.Any(c => c == "Student"))
            {
                var lstStudent = await _studentUPRepo.GetAllStudentUPAsync();
                if (lstStudent.Any(c => c.Id != Guid.Parse(_User.Id)))
                {
                    var studentgmail = _User.Email.Split("@")[0];
                    var studentCode = studentgmail.Substring(studentgmail.Length - 7).ToUpper();
                    var studentInClassCreate = new StudentUpDto()
                        {
                            Email = _User.Email,
                            Ethnic = "",
                            Address = "",
                            DateOfBirth = DateTime.Now,
                            Description = "",
                            FathersName = "",
                            Gender = true,
                            HomeTown = "",
                            Id = Guid.Parse(_User.Id),
                            IdentityCardNumber = "",
                            ImageUrl = "",
                            IssuedOn = DateTime.Now,
                            MotherName = "",
                            Password = "",
                            PhoneNumber = "",
                            Status = 2,
                            StudentCode = studentCode,
                            StudentName = ""

                        };
                    await _studentUPRepo.CreateStudentUPstudentInClass(studentInClassCreate);

                }
                else
                {

                    var studentUP = lstStudent.Find(c => c.Id == Guid.Parse(_User.Id));
                    var update = new FPLSP.Server.Infrastructure.ViewModels.StudentsUPVm.StudentUpdateVM()
                        {
                            Email = studentUP.Email,
                            Ethnic = studentUP.Ethnic,
                            Address = studentUP.Address,
                            DateOfBirth = studentUP.DateOfBirth.Value,
                            Description = studentUP.Description,
                            FathersName = studentUP.FathersName,
                            Gender = studentUP.Gender.Value,
                            HomeTown = studentUP.HomeTown,
                            IdentityCardNumber = studentUP.IdentityCardNumber,
                            ImageUrl = studentUP.ImageUrl,
                            IssuedOn = studentUP.IssuedOn.Value,
                            MotherName = studentUP.MotherName,
                            PhoneNumber = studentUP.PhoneNumber,
                            StudentCode = studentUP.StudentCode,
                            StudentName = studentUP.StudentName,
                            Password = studentUP.Password,
                            Status = studentUP.Status.Value,
                            IsDelete = false

                        };

                    await _studentUPRepo.UpdateStudentUP(studentUP.Id, update);
                }
            }
            //kiểm tra xem tất cả role hiện tại sau khi đã thêm hoặc cập nhật role đã có admin core chưa
            if (userUpdateRoles.RoleNames.ToList().Any(c => c != "AdminCore"))
            {


             
                if (_User.IdTrainingFacility != Guid.Empty)
                {
                    //kiểm tra xem cơ sở cũ ở trongdatabase với cơ sở mới vừa chọn có khác nhau hay không
                    var getCurrentUser = await _UserIdentityRepo.GetUserRoleById(GetId);
                    if (getCurrentUser.IdTrainingFacility != _User.IdTrainingFacility)
                    {
                        foreach (var user in _userManager.Users.ToList().Where(c => c.Id == GetId))
                        {
                            user.IdTrainingFacility = _User.IdTrainingFacility;
                            await _userManager.UpdateAsync(user);

                        }
                    }



                    //cập nhật mới lại cho giảng viên
                    if (userUpdateRoles.RoleNames.ToList().Any(c => c == "Lecturer" || c == "LecturerFPLSP"))
                    {
                        var update = new CreateleatureForTrainVm()
                            {
                                Id = Guid.Parse(_User.Id),
                                Email = _User.UserName,
                                IdTrain = _User.IdTrainingFacility
                            };
                        var all = await _lecturersCPRepo.GetAllLecturerAsync();
                        foreach (var x in all.Where(c => c.Email == _User.Email))
                        {
                            x.TrainingFacilitiesId = _User.IdTrainingFacility;
                            await _lecturersCPRepo.UpdateLecturerTrain(x.Id, update);
                        }
                    }
                }
            }

            if (_User.IdTrainingFacility == Guid.Empty)
            {
                _toastService.ShowError("Bạn chưa chọn cơ sở ");
                
                return;
            }
            else
            {
              
                var res = await _UserIdentityRepo.AddRolesToUser(userUpdateRoles);
                if (res)
                {
                    
                    toastService.ShowSuccess($"Cấp quyền thành công cho {_User.UserName}");
                    Navigation.NavigateTo($"/listuseriden/{_cryptoServices.Encrypt(maxlevel.ToString().Replace("/", "I0H"))}/{_cryptoServices.Encrypt(IdCoSo.ToString().Replace("/", "I0H"))}");
                }
                else
                {
                    toastService.ShowError($"Cấp quyền thất bại cho {_User.UserName}");
                    
                    return;
                }
            }
        }
        else
        {
            _User.ListRoles = _UserFlag.ListRoles;
            flagChageUserRole = false;
            
        }

    }
    protected override async Task OnInitializedAsync()
    {
        GetId = _cryptoServices.Decrypt(GetIdNonDecrpyt.Replace("I0H", "/"));
        maxlevel = _cryptoServices.Decrypt(maxlevelNonDecrpyt.Replace("I0H", "/"));
        IdCoSo = _cryptoServices.Decrypt(IdCoSoNonDecrpyt.Replace("I0H", "/"));
        _lstRedirect.Add(new Claim("CanViewFPLSPProject", "true"));
        _lstRedirect.Add(new Claim("CanViewCabinProject", "true"));
        _lstRedirect.Add(new Claim("CanViewFPLExam", "true"));
        _User = await _UserIdentityRepo.GetUserRoleById(GetId);
        _UserFlag = await _UserIdentityRepo.GetUserRoleById(GetId);
        idTrainFlag = _User.IdTrainingFacility;
        _lstTrain = await _trainingFacilitiesCPRepo.GetTrainingFacilitiesAsync();

        _lstRole = await _roleUserIdentityRepo.GetAllRolesAsync();
        //xử lý loại trừ các role cấp cao hơn role mà dường dùng truyền vào

        var lstRolremove = new List<IdentityRole>();
        foreach (IdentityRole role in _lstRole)
        {
            if (maxlevel == "6")
            {
                if (role.Name == "AdminCore")
                {
                    lstRolremove.Add(role);
                }
            }
            else if (maxlevel == "5")
            {
                if (role.Name == "AdminCS" || role.Name == "AdminCore")
                {
                    lstRolremove.Add(role);
                }
            }
            else if (maxlevel == "4")
            {
                if (role.Name == "AdminCS" || role.Name == "AdminCore" || role.Name == "DirectorOfTraining")
                {
                    lstRolremove.Add(role);
                }
            }
            else if (maxlevel == "3")
            {


                if (role.Name == "AdminCS" || role.Name == "AdminCore" || role.Name == "DirectorOfTraining" || role.Name == "HeadOfDepartment")
                {
                    lstRolremove.Add(role);
                }
            }

            else if (maxlevel == "2")
            {
                if (role.Name == "AdminCS" || role.Name == "AdminCore" || role.Name == "DirectorOfTraining" || role.Name == "HeadOfDepartment" || role.Name == "Staff")
                {
                    lstRolremove.Add(role);
                }
            }
        }
        foreach (var item in lstRolremove)
        {
            _lstRole.Remove(item);
        }

        var let = await _lecturersCPRepo.GetAllLecturerAsync();

    }

    private async Task UpdateRoleForUser(EditContext editContext)
    {

    }
    private async Task AddRedirect(Claim claim)
    {
        if (_User.ListRedirectClaims.Any(c => c.Type == claim.Type) == false)
        {
            _User.ListRedirectClaims.Add(claim);
        }
    }
    public async void Add(string name)
    {
        //if (name == "LecturerFPLSP")
        //{
        //    if (_User.ListRoles.Any(c => c == "Student"))
        //    {
        //        _toastService.ShowError("Hãy xóa quyền sinh viên trước khi cập nhập quyền là giảng viên");
        //        return;
        //    }
        //}
        //if (name == "Student")
        //{
        //    if (_User.ListRoles.Any(c => c == "LecturerFPLSP"))
        //    {
        //        _toastService.ShowError("Hãy xóa quyền giảng viên trước khi cập nhập quyền là sinh viên");
        //        return;
        //    }
        //}
        //if (name == "GV FPLExam")
        //{
        //    if (_User.ListRoles.Any(c => c == "TBM FPLExam" || c == "SV FPLExam"))
        //    {
        //        _toastService.ShowError("Hãy xóa quyền TBM Exam hoặc SV FPLExam trước khi cập nhập quyền là GV Exam");
        //        return;
        //    }
        //}
        //if (name == "TBM FPLExam")
        //{
        //    if (_User.ListRoles.Any(c => c == "GV FPLExam" || c == "SV FPLExam"))
        //    {
        //        _toastService.ShowError("Hãy xóa quyền GV Exam hoặc SV FPLExam trước khi cập nhập quyền là TBM Exam");
        //        return;
        //    }
        //}
        //if (name == "SV FPLExam")
        //{
        //    if (_User.ListRoles.Any(c => c == "GV FPLExam" || c == "TBM FPLExam"))
        //    {
        //        _toastService.ShowError("Hãy xóa quyền GV Exam hoặc TBM FPLExam trước khi cập nhập quyền là SV Exam");
        //        return;
        //    }
        //}


        if (_User.ListRoles.Any(c => c == name) == false)
        {
            _User.ListRoles.Add(name);

        }
    }
    bool flagChageIDTrain = false;
    bool flagChageUserRole = false;
    public void AddTrain(Guid IdCoSo)
    {
        if (_User.IdTrainingFacility != IdCoSo)
        {
            _User.IdTrainingFacility = IdCoSo;


        }
    }
    private async void AddRoleToUser()
    {
        if (_UserFlag.ListRoles.Any(c => c == "LecturerFPLSP"))
        {
            if (!_User.ListRoles.Any(c => c == "LecturerFPLSP"))
            {
                flagChageUserRole = true;
            }
        }
        if (_UserFlag.ListRoles.Any(c => c == "Student"))
        {
            if (!_User.ListRoles.Any(c => c == "Student"))
            {
                flagChageUserRole = true;
            }
        }
        if (_UserFlag.IdTrainingFacility != _User.IdTrainingFacility)
        {
            flagChageIDTrain = true;
        }
    
        if (!flagChageUserRole)
        {
            if (!flagChageIDTrain)
            {   
                UserUpdateRolesHasClaims userUpdateRoles = new UserUpdateRolesHasClaims()
                    {
                        ID = GetId,
                        Name = _User.UserName,
                        claims = _User.ListRedirectClaims,
                        RoleNames = _User.ListRoles.ToArray()
                    };

                //Check tồn tại phù hợp với quyền
                if (userUpdateRoles.RoleNames.Any(c => c == "GV FPLExam") || userUpdateRoles.RoleNames.Any(c => c == "LecturerFPLSP"))
                {
                    var lstLeture = await _lecturersCPRepo.GetLecturerMapper();
                    lstLeture = lstLeture.Where(c => c.LecturersCode.Contains("GV")).ToList();
                    if (lstLeture.Any(c => c.Id == Guid.Parse(_User.Id)))
                    {
                        var lectureCP = lstLeture.Find(c => c.Id == Guid.Parse(_User.Id));
                        lectureCP.IsDeleted = false;

                        await _lecturersCPRepo.UpdateLectureCP(lectureCP);
                    }
                    else
                    {
                        var createLeture = new CreateleatureForTrainVm()
                            {
                                Email = _User.Email,
                                IdTrain = _User.IdTrainingFacility,
                                Id = Guid.Parse(_User.Id)

                            };
                        await _lecturersCPRepo.CreateLecturerForTrain(createLeture);
                    }

                }
                if (userUpdateRoles.RoleNames.Any(c => c == "Student"))
                {
                    var lstStudent = await _studentUPRepo.GetAllStudentDtosAsync();

                    var a = lstStudent.FirstOrDefault(c => c.Id == Guid.Parse(_User.Id));
                    if (lstStudent.Any(c => c.Id == Guid.Parse(_User.Id)))
                    {
                        var studentUP = lstStudent.Find(c => c.Id == Guid.Parse(_User.Id));
                        var update = new FPLSP.Server.Infrastructure.ViewModels.StudentsUPVm.StudentUpdateVM()
                            {
                                Email = studentUP.Email,
                                Ethnic = studentUP.Ethnic,
                                Address = studentUP.Address,
                                DateOfBirth = studentUP.DateOfBirth,
                                Description = studentUP.Description,
                                FathersName = studentUP.FathersName,
                                Gender = studentUP.Gender,
                                HomeTown = studentUP.HomeTown,
                                IdentityCardNumber = studentUP.IdentityCardNumber,
                                ImageUrl = studentUP.ImageUrl,
                                IssuedOn = studentUP.IssuedOn,
                                MotherName = studentUP.MotherName,
                                PhoneNumber = studentUP.PhoneNumber,
                                StudentCode = studentUP.StudentCode,
                                StudentName = studentUP.StudentName,
                                Password = studentUP.Password,
                                Status = studentUP.Status,
                                IsDelete = false

                            };

                        await _studentUPRepo.UpdateStudentUP(studentUP.Id, update);



                    }
                    else
                    {

                        var studentgmail = _User.Email.Split("@")[0];
                        var studentCode = studentgmail.Substring(studentgmail.Length - 7).ToUpper();
                        var studentInClassCreate = new StudentUpDto()
                            {
                                Email = _User.Email,
                                Ethnic = "",
                                Address = "",
                                DateOfBirth = DateTime.Now,
                                Description = "",
                                FathersName = "",
                                Gender = true,
                                HomeTown = "",
                                Id = Guid.Parse(_User.Id),
                                IdentityCardNumber = "",
                                ImageUrl = "",
                                IssuedOn = DateTime.Now,
                                MotherName = "",
                                Password = "",
                                PhoneNumber = "",
                                Status = 2,
                                StudentCode = studentCode,
                                StudentName = ""

                            };
                        await _studentUPRepo.CreateStudentUPstudentInClass(studentInClassCreate);
                    }
                }
                //kiểm tra xem tất cả role hiện tại sau khi đã thêm hoặc cập nhật role đã có admin core chưa
                if (userUpdateRoles.RoleNames.ToList().Any(c => c != "AdminCore"))
                {



                    if (_User.IdTrainingFacility != Guid.Empty)
                    {
                        //kiểm tra xem cơ sở cũ ở trongdatabase với cơ sở mới vừa chọn có khác nhau hay không
                        var getCurrentUser = await _UserIdentityRepo.GetUserRoleById(GetId);
                        if (getCurrentUser.IdTrainingFacility != _User.IdTrainingFacility)
                        {
                            foreach (var user in _userManager.Users.ToList().Where(c => c.Id == GetId))
                            {
                                user.IdTrainingFacility = _User.IdTrainingFacility;
                                await _userManager.UpdateAsync(user);

                            }
                        }



                        //cập nhật mới lại cho giảng viên
                        if (userUpdateRoles.RoleNames.ToList().Any(c => c == "Lecturer" || c == "LecturerFPLSP"))
                        {
                            var update = new CreateleatureForTrainVm()
                                {
                                    Id = Guid.Parse(_User.Id),
                                    Email = _User.UserName,
                                    IdTrain = _User.IdTrainingFacility
                                };
                            var all = await _lecturersCPRepo.GetAllLecturerAsync();
                            foreach (var x in all.Where(c => c.Email == _User.Email))
                            {
                                x.TrainingFacilitiesId = _User.IdTrainingFacility;
                                await _lecturersCPRepo.UpdateLecturerTrain(x.Id, update);
                            }
                        }
                    }
                }

                if (_User.IdTrainingFacility == Guid.Empty)
                {
                    _toastService.ShowError("Bạn chưa chọn cơ sở ");
                    
                    return;
                }
                else
                {
                   
                    var res = await _UserIdentityRepo.AddRolesToUser(userUpdateRoles);
                    if (res)
                    {
                        toastService.ShowSuccess($"Cấp quyền thành công cho {_User.UserName}");
                        
                        Navigation.NavigateTo($"/listuseriden/{_cryptoServices.Encrypt(maxlevel.ToString().Replace("/", "I0H"))}/{_cryptoServices.Encrypt(IdCoSo.ToString().Replace("/", "I0H"))}");
                    }
                    else
                    {
                        toastService.ShowError($"Cấp quyền thất bại cho {_User.UserName}");
                        
                        return;
                    }
                }
            }
            else
            {
                DeleteConfirmation.show();
                
            }
        }
        else
        {
            DeleteConfirmationUser.show();
            
        }




    }
    public void Closed(MudChip chip) => _User.ListRoles.Remove(chip.Text);
    public void RemoveReDirect(MudChip chip)
    {

        _User.ListRedirectClaims.Remove((Claim)chip.Value);
    }


#line default
#line hidden
#nullable disable
    }
}
#pragma warning restore 1591
