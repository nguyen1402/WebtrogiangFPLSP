#pragma checksum "C:\Users\Nguyen Bui\source\repos\FPLSP3\FPLSP\Pages\UserManagerPages\ListUsersIdentity.razor" "{ff1816ec-aa5e-4d10-87f7-6f4963833460}" "f0a0dcc92e1c1d4fbdc292b40b6f725485207da2"
// <auto-generated/>
#pragma warning disable 1591
namespace FPLSP.Pages.UserManagerPages
{
    #line hidden
    using System;
    using System.Collections.Generic;
    using System.Linq;
    using System.Threading.Tasks;
    using Microsoft.AspNetCore.Components;
#nullable restore
#line 1 "C:\Users\Nguyen Bui\source\repos\FPLSP3\FPLSP\_Imports.razor"
using System.Net.Http;

#line default
#line hidden
#nullable disable
#nullable restore
#line 2 "C:\Users\Nguyen Bui\source\repos\FPLSP3\FPLSP\_Imports.razor"
using Microsoft.AspNetCore.Authorization;

#line default
#line hidden
#nullable disable
#nullable restore
#line 3 "C:\Users\Nguyen Bui\source\repos\FPLSP3\FPLSP\_Imports.razor"
using Microsoft.AspNetCore.Components.Authorization;

#line default
#line hidden
#nullable disable
#nullable restore
#line 4 "C:\Users\Nguyen Bui\source\repos\FPLSP3\FPLSP\_Imports.razor"
using Microsoft.AspNetCore.Components.Forms;

#line default
#line hidden
#nullable disable
#nullable restore
#line 5 "C:\Users\Nguyen Bui\source\repos\FPLSP3\FPLSP\_Imports.razor"
using Microsoft.AspNetCore.Components.Routing;

#line default
#line hidden
#nullable disable
#nullable restore
#line 6 "C:\Users\Nguyen Bui\source\repos\FPLSP3\FPLSP\_Imports.razor"
using Microsoft.AspNetCore.Components.Web;

#line default
#line hidden
#nullable disable
#nullable restore
#line 7 "C:\Users\Nguyen Bui\source\repos\FPLSP3\FPLSP\_Imports.razor"
using Microsoft.AspNetCore.Components.Web.Virtualization;

#line default
#line hidden
#nullable disable
#nullable restore
#line 8 "C:\Users\Nguyen Bui\source\repos\FPLSP3\FPLSP\_Imports.razor"
using Microsoft.JSInterop;

#line default
#line hidden
#nullable disable
#nullable restore
#line 9 "C:\Users\Nguyen Bui\source\repos\FPLSP3\FPLSP\_Imports.razor"
using FPLSP;

#line default
#line hidden
#nullable disable
#nullable restore
#line 10 "C:\Users\Nguyen Bui\source\repos\FPLSP3\FPLSP\_Imports.razor"
using FPLSP.Shared;

#line default
#line hidden
#nullable disable
#nullable restore
#line 11 "C:\Users\Nguyen Bui\source\repos\FPLSP3\FPLSP\_Imports.razor"
using MudBlazor;

#line default
#line hidden
#nullable disable
#nullable restore
#line 12 "C:\Users\Nguyen Bui\source\repos\FPLSP3\FPLSP\_Imports.razor"
using FPLSP.Components;

#line default
#line hidden
#nullable disable
#nullable restore
#line 13 "C:\Users\Nguyen Bui\source\repos\FPLSP3\FPLSP\_Imports.razor"
using Blazored.Typeahead;

#line default
#line hidden
#nullable disable
#nullable restore
#line 14 "C:\Users\Nguyen Bui\source\repos\FPLSP3\FPLSP\_Imports.razor"
using CurrieTechnologies.Razor.SweetAlert2;

#line default
#line hidden
#nullable disable
#nullable restore
#line 2 "C:\Users\Nguyen Bui\source\repos\FPLSP3\FPLSP\Pages\UserManagerPages\ListUsersIdentity.razor"
using Blazored.Toast.Services;

#line default
#line hidden
#nullable disable
#nullable restore
#line 3 "C:\Users\Nguyen Bui\source\repos\FPLSP3\FPLSP\Pages\UserManagerPages\ListUsersIdentity.razor"
using FPLSP.Data;

#line default
#line hidden
#nullable disable
#nullable restore
#line 4 "C:\Users\Nguyen Bui\source\repos\FPLSP3\FPLSP\Pages\UserManagerPages\ListUsersIdentity.razor"
using FPLSP.Data.Securities;

#line default
#line hidden
#nullable disable
#nullable restore
#line 5 "C:\Users\Nguyen Bui\source\repos\FPLSP3\FPLSP\Pages\UserManagerPages\ListUsersIdentity.razor"
using FPLSP.Repositories.Interfaces;

#line default
#line hidden
#nullable disable
#nullable restore
#line 6 "C:\Users\Nguyen Bui\source\repos\FPLSP3\FPLSP\Pages\UserManagerPages\ListUsersIdentity.razor"
using FPLSP.Server.Data.SeedWork;

#line default
#line hidden
#nullable disable
#nullable restore
#line 7 "C:\Users\Nguyen Bui\source\repos\FPLSP3\FPLSP\Pages\UserManagerPages\ListUsersIdentity.razor"
using FPLSP.Server.Domain.Dtos.StudentUPDtos;

#line default
#line hidden
#nullable disable
#nullable restore
#line 8 "C:\Users\Nguyen Bui\source\repos\FPLSP3\FPLSP\Pages\UserManagerPages\ListUsersIdentity.razor"
using FPLSP.Server.Domain.Entities.CoresParts;

#line default
#line hidden
#nullable disable
#nullable restore
#line 9 "C:\Users\Nguyen Bui\source\repos\FPLSP3\FPLSP\Pages\UserManagerPages\ListUsersIdentity.razor"
using FPLSP.Server.Infrastructure.ViewModels;

#line default
#line hidden
#nullable disable
#nullable restore
#line 10 "C:\Users\Nguyen Bui\source\repos\FPLSP3\FPLSP\Pages\UserManagerPages\ListUsersIdentity.razor"
using Microsoft.AspNetCore.Identity;

#line default
#line hidden
#nullable disable
#nullable restore
#line 11 "C:\Users\Nguyen Bui\source\repos\FPLSP3\FPLSP\Pages\UserManagerPages\ListUsersIdentity.razor"
using System.Security.Claims;

#line default
#line hidden
#nullable disable
#nullable restore
#line 12 "C:\Users\Nguyen Bui\source\repos\FPLSP3\FPLSP\Pages\UserManagerPages\ListUsersIdentity.razor"
           [Authorize(Roles = "AdminCore,AdminCS")]

#line default
#line hidden
#nullable disable
    [global::Microsoft.AspNetCore.Components.RouteAttribute("/listuseriden/{maxlevelNonDecrpyt}/{IdCoSoNonDecrpyt}")]
    public partial class ListUsersIdentity : global::Microsoft.AspNetCore.Components.ComponentBase
    {
        #pragma warning disable 1998
        protected override void BuildRenderTree(global::Microsoft.AspNetCore.Components.Rendering.RenderTreeBuilder __builder)
        {
            __builder.OpenElement(0, "Spin");
            __builder.AddAttribute(1, "Spinning", 
#nullable restore
#line 14 "C:\Users\Nguyen Bui\source\repos\FPLSP3\FPLSP\Pages\UserManagerPages\ListUsersIdentity.razor"
                IsShowLoading

#line default
#line hidden
#nullable disable
            );
            __builder.AddAttribute(2, "Delay", "500");
            __builder.AddAttribute(3, "Tip", "Loading........");
            __builder.CloseElement();
#nullable restore
#line 18 "C:\Users\Nguyen Bui\source\repos\FPLSP3\FPLSP\Pages\UserManagerPages\ListUsersIdentity.razor"
 if (_lstUsers != null)
{
    if (userRoleSearch.StatusNotRole == 1)
    {

#line default
#line hidden
#nullable disable
            __builder.OpenElement(4, "div");
            __builder.AddAttribute(5, "class", "d-grid gap-2 d-md-flex justify-content-md-end mt-1");
            __builder.AddAttribute(6, "style", "z-index: 1000;right: 25px;position: fixed;");
            __builder.OpenElement(7, "a");
            __builder.AddAttribute(8, "class", "btn btn-outline-success");
            __builder.AddAttribute(9, "onclick", global::Microsoft.AspNetCore.Components.EventCallback.Factory.Create<global::Microsoft.AspNetCore.Components.Web.MouseEventArgs>(this, 
#nullable restore
#line 23 "C:\Users\Nguyen Bui\source\repos\FPLSP3\FPLSP\Pages\UserManagerPages\ListUsersIdentity.razor"
                                                         AddAllUserNotRole

#line default
#line hidden
#nullable disable
            ));
            __builder.AddMarkupContent(10, "<i class=\"fa-solid fa-pen-to-square\"></i>");
            __builder.CloseElement();
            __builder.CloseElement();
#nullable restore
#line 25 "C:\Users\Nguyen Bui\source\repos\FPLSP3\FPLSP\Pages\UserManagerPages\ListUsersIdentity.razor"
    }


#line default
#line hidden
#nullable disable
            __builder.OpenElement(11, "div");
            __builder.AddAttribute(12, "class", "row");
            __builder.OpenComponent<global::Microsoft.AspNetCore.Components.Forms.EditForm>(13);
            __builder.AddAttribute(14, "class", "row");
            __builder.AddAttribute(15, "Model", global::Microsoft.AspNetCore.Components.CompilerServices.RuntimeHelpers.TypeCheck<global::System.Object>(
#nullable restore
#line 29 "C:\Users\Nguyen Bui\source\repos\FPLSP3\FPLSP\Pages\UserManagerPages\ListUsersIdentity.razor"
                                     userRoleSearch

#line default
#line hidden
#nullable disable
            ));
            __builder.AddAttribute(16, "OnSubmit", global::Microsoft.AspNetCore.Components.CompilerServices.RuntimeHelpers.TypeCheck<global::Microsoft.AspNetCore.Components.EventCallback<global::Microsoft.AspNetCore.Components.Forms.EditContext>>(global::Microsoft.AspNetCore.Components.EventCallback.Factory.Create<global::Microsoft.AspNetCore.Components.Forms.EditContext>(this, 
#nullable restore
#line 29 "C:\Users\Nguyen Bui\source\repos\FPLSP3\FPLSP\Pages\UserManagerPages\ListUsersIdentity.razor"
                                                               SearchTask

#line default
#line hidden
#nullable disable
            )));
            __builder.AddAttribute(17, "ChildContent", (global::Microsoft.AspNetCore.Components.RenderFragment<Microsoft.AspNetCore.Components.Forms.EditContext>)((context) => (__builder2) => {
                __builder2.OpenElement(18, "div");
                __builder2.AddAttribute(19, "class", "col-lg-3");
                global::__Blazor.FPLSP.Pages.UserManagerPages.ListUsersIdentity.TypeInference.CreateInputSelect_0(__builder2, 20, 21, "form-select", 22, 
#nullable restore
#line 31 "C:\Users\Nguyen Bui\source\repos\FPLSP3\FPLSP\Pages\UserManagerPages\ListUsersIdentity.razor"
                                                                    ()=>userRoleSearch.Role

#line default
#line hidden
#nullable disable
                , 23, 
#nullable restore
#line 31 "C:\Users\Nguyen Bui\source\repos\FPLSP3\FPLSP\Pages\UserManagerPages\ListUsersIdentity.razor"
                                                                                                      userRoleSearch.Role

#line default
#line hidden
#nullable disable
                , 24, global::Microsoft.AspNetCore.Components.EventCallback.Factory.Create(this, 
#nullable restore
#line 31 "C:\Users\Nguyen Bui\source\repos\FPLSP3\FPLSP\Pages\UserManagerPages\ListUsersIdentity.razor"
                                                                                                                                           (string? value)=> SearchRole(value)

#line default
#line hidden
#nullable disable
                ), 25, (__builder3) => {
                    __builder3.AddMarkupContent(26, "<option value>Các quyền</option>");
#nullable restore
#line 33 "C:\Users\Nguyen Bui\source\repos\FPLSP3\FPLSP\Pages\UserManagerPages\ListUsersIdentity.razor"
                     foreach (var item in _lstRole)
                    {

#line default
#line hidden
#nullable disable
                    __builder3.OpenElement(27, "option");
                    __builder3.AddAttribute(28, "value", 
#nullable restore
#line 35 "C:\Users\Nguyen Bui\source\repos\FPLSP3\FPLSP\Pages\UserManagerPages\ListUsersIdentity.razor"
                                        item

#line default
#line hidden
#nullable disable
                    );
#nullable restore
#line (35,48)-(35,52) 26 "C:\Users\Nguyen Bui\source\repos\FPLSP3\FPLSP\Pages\UserManagerPages\ListUsersIdentity.razor"
__builder3.AddContent(29, item);

#line default
#line hidden
#nullable disable
                    __builder3.CloseElement();
#nullable restore
#line 36 "C:\Users\Nguyen Bui\source\repos\FPLSP3\FPLSP\Pages\UserManagerPages\ListUsersIdentity.razor"
                    }

#line default
#line hidden
#nullable disable
                }
                );
                __builder2.CloseElement();
                __builder2.AddMarkupContent(30, "\r\n            ");
                __builder2.OpenElement(31, "div");
                __builder2.AddAttribute(32, "class", "col-lg-3");
                global::__Blazor.FPLSP.Pages.UserManagerPages.ListUsersIdentity.TypeInference.CreateInputSelect_1(__builder2, 33, 34, "form-select", 35, 
#nullable restore
#line 40 "C:\Users\Nguyen Bui\source\repos\FPLSP3\FPLSP\Pages\UserManagerPages\ListUsersIdentity.razor"
                                                                    ()=>userRoleSearch.StatusNotRole

#line default
#line hidden
#nullable disable
                , 36, 
#nullable restore
#line 40 "C:\Users\Nguyen Bui\source\repos\FPLSP3\FPLSP\Pages\UserManagerPages\ListUsersIdentity.razor"
                                                                                                               userRoleSearch.StatusNotRole

#line default
#line hidden
#nullable disable
                , 37, global::Microsoft.AspNetCore.Components.EventCallback.Factory.Create(this, 
#nullable restore
#line 40 "C:\Users\Nguyen Bui\source\repos\FPLSP3\FPLSP\Pages\UserManagerPages\ListUsersIdentity.razor"
                                                                                                                                                             (int value)=> SearchStatsNotRole(value)

#line default
#line hidden
#nullable disable
                ), 38, (__builder3) => {
                    __builder3.AddMarkupContent(39, "<option selected value=\"0\">Tất cả quyền</option>\r\n                    ");
                    __builder3.AddMarkupContent(40, "<option value=\"1\">Không quyền</option>");
                }
                );
                __builder2.CloseElement();
                __builder2.AddMarkupContent(41, "\r\n            ");
                __builder2.OpenElement(42, "div");
                __builder2.AddAttribute(43, "class", " col-lg-3");
                __builder2.OpenElement(44, "div");
                __builder2.AddAttribute(45, "class", "input-group mb-3");
                __builder2.OpenComponent<global::Microsoft.AspNetCore.Components.Forms.InputText>(46);
                __builder2.AddAttribute(47, "placeholder", "Nhập Tên ...");
                __builder2.AddAttribute(48, "class", "form-control");
                __builder2.AddAttribute(49, "Value", global::Microsoft.AspNetCore.Components.CompilerServices.RuntimeHelpers.TypeCheck<global::System.String>(
#nullable restore
#line 48 "C:\Users\Nguyen Bui\source\repos\FPLSP3\FPLSP\Pages\UserManagerPages\ListUsersIdentity.razor"
                                                                                            userRoleSearch.Name

#line default
#line hidden
#nullable disable
                ));
                __builder2.AddAttribute(50, "ValueChanged", global::Microsoft.AspNetCore.Components.CompilerServices.RuntimeHelpers.TypeCheck<global::Microsoft.AspNetCore.Components.EventCallback<global::System.String>>(global::Microsoft.AspNetCore.Components.EventCallback.Factory.Create<global::System.String>(this, global::Microsoft.AspNetCore.Components.CompilerServices.RuntimeHelpers.CreateInferredEventCallback(this, __value => userRoleSearch.Name = __value, userRoleSearch.Name))));
                __builder2.AddAttribute(51, "ValueExpression", global::Microsoft.AspNetCore.Components.CompilerServices.RuntimeHelpers.TypeCheck<global::System.Linq.Expressions.Expression<System.Func<System.String>>>(() => userRoleSearch.Name));
                __builder2.CloseComponent();
                __builder2.AddMarkupContent(52, "\r\n                    ");
                __builder2.AddMarkupContent(53, "<div class=\"input-group-append pl-1\"><button type=\"submit\" class=\"btn btn-primary\">Tìm kiếm</button></div>");
                __builder2.CloseElement();
                __builder2.CloseElement();
                __builder2.AddMarkupContent(54, "\r\n            ");
                __builder2.OpenElement(55, "div");
                __builder2.AddAttribute(56, "class", " col-lg-3");
                __builder2.OpenElement(57, "div");
                __builder2.AddAttribute(58, "class", "input-group mb-3");
                __builder2.OpenElement(59, "div");
                __builder2.AddAttribute(60, "class", "input-group-append pl-1");
                __builder2.OpenElement(61, "button");
                __builder2.AddAttribute(62, "type", "button");
                __builder2.AddAttribute(63, "onclick", global::Microsoft.AspNetCore.Components.EventCallback.Factory.Create<global::Microsoft.AspNetCore.Components.Web.MouseEventArgs>(this, 
#nullable restore
#line 58 "C:\Users\Nguyen Bui\source\repos\FPLSP3\FPLSP\Pages\UserManagerPages\ListUsersIdentity.razor"
                                                        Clear

#line default
#line hidden
#nullable disable
                ));
                __builder2.AddAttribute(64, "class", "btn btn-primary");
                __builder2.AddMarkupContent(65, "Làm Mới");
                __builder2.CloseElement();
                __builder2.CloseElement();
                __builder2.CloseElement();
                __builder2.CloseElement();
            }
            ));
            __builder.CloseComponent();
            __builder.AddMarkupContent(66, "\r\n\r\n        ");
            __builder.OpenElement(67, "table");
            __builder.AddAttribute(68, "class", "table table-hover align-middle table-bordered mt-3 text-center");
            __builder.AddMarkupContent(69, "<thead class=\"table-success\"><tr><th scope=\"col\">Tên người dùng</th>\r\n                    <th scope=\"col\">Vai Trò</th>\r\n                    <th scope=\"col\">Điều Hướng</th>\r\n                    <th scope=\"col\">Tác Vụ</th></tr></thead>\r\n            ");
            __builder.OpenElement(70, "tbody");
#nullable restore
#line 76 "C:\Users\Nguyen Bui\source\repos\FPLSP3\FPLSP\Pages\UserManagerPages\ListUsersIdentity.razor"
                 foreach (var x in _lstUsers)
                {

#line default
#line hidden
#nullable disable
            __builder.OpenElement(71, "tr");
            __builder.OpenElement(72, "td");
#nullable restore
#line (80,30)-(80,40) 25 "C:\Users\Nguyen Bui\source\repos\FPLSP3\FPLSP\Pages\UserManagerPages\ListUsersIdentity.razor"
__builder.AddContent(73, x.UserName);

#line default
#line hidden
#nullable disable
            __builder.CloseElement();
            __builder.AddMarkupContent(74, "\r\n                        ");
            __builder.OpenElement(75, "td");
#nullable restore
#line 82 "C:\Users\Nguyen Bui\source\repos\FPLSP3\FPLSP\Pages\UserManagerPages\ListUsersIdentity.razor"
                             if (x.ListRoles.Count() == 0)
                            {

#line default
#line hidden
#nullable disable
            __builder.AddMarkupContent(76, "<th>Chưa cấp quyền</th>");
#nullable restore
#line 85 "C:\Users\Nguyen Bui\source\repos\FPLSP3\FPLSP\Pages\UserManagerPages\ListUsersIdentity.razor"
                            }
                            else
                            {

#line default
#line hidden
#nullable disable
            __builder.OpenElement(77, "th");
#nullable restore
#line (88,34)-(88,75) 25 "C:\Users\Nguyen Bui\source\repos\FPLSP3\FPLSP\Pages\UserManagerPages\ListUsersIdentity.razor"
__builder.AddContent(78, String.Join(" , ", x.ListRoles.ToArray()));

#line default
#line hidden
#nullable disable
            __builder.CloseElement();
#nullable restore
#line 89 "C:\Users\Nguyen Bui\source\repos\FPLSP3\FPLSP\Pages\UserManagerPages\ListUsersIdentity.razor"
                            }

#line default
#line hidden
#nullable disable
            __builder.CloseElement();
            __builder.AddMarkupContent(79, "\r\n                        ");
            __builder.OpenElement(80, "td");
#nullable restore
#line 93 "C:\Users\Nguyen Bui\source\repos\FPLSP3\FPLSP\Pages\UserManagerPages\ListUsersIdentity.razor"
                             if (x.ListRedirectClaims.Count() == 0)
                            {

#line default
#line hidden
#nullable disable
            __builder.AddMarkupContent(81, "<th>Chưa điều hướng</th>");
#nullable restore
#line 96 "C:\Users\Nguyen Bui\source\repos\FPLSP3\FPLSP\Pages\UserManagerPages\ListUsersIdentity.razor"
                            }
                            else
                            {
                                

#line default
#line hidden
#nullable disable
#nullable restore
#line 99 "C:\Users\Nguyen Bui\source\repos\FPLSP3\FPLSP\Pages\UserManagerPages\ListUsersIdentity.razor"
                                 foreach (var de in x.ListRedirectClaims)
                                {

                                    if (de.Type == "CanViewFPLSPProject")
                                    {

#line default
#line hidden
#nullable disable
            __builder.OpenElement(82, "th");
            __builder.AddContent(83, " FPL Support (");
#nullable restore
#line (104,56)-(104,64) 25 "C:\Users\Nguyen Bui\source\repos\FPLSP3\FPLSP\Pages\UserManagerPages\ListUsersIdentity.razor"
__builder.AddContent(84, de.Value);

#line default
#line hidden
#nullable disable
            __builder.AddContent(85, "), ");
            __builder.CloseElement();
#nullable restore
#line 105 "C:\Users\Nguyen Bui\source\repos\FPLSP3\FPLSP\Pages\UserManagerPages\ListUsersIdentity.razor"
                                    }
                                    if (de.Type == "CanViewCabinProject")
                                    {

#line default
#line hidden
#nullable disable
            __builder.OpenElement(86, "th");
            __builder.AddContent(87, " Cabin Project (");
#nullable restore
#line (108,58)-(108,66) 25 "C:\Users\Nguyen Bui\source\repos\FPLSP3\FPLSP\Pages\UserManagerPages\ListUsersIdentity.razor"
__builder.AddContent(88, de.Value);

#line default
#line hidden
#nullable disable
            __builder.AddContent(89, "), ");
            __builder.CloseElement();
#nullable restore
#line 109 "C:\Users\Nguyen Bui\source\repos\FPLSP3\FPLSP\Pages\UserManagerPages\ListUsersIdentity.razor"
                                    }
                                    if (de.Type == "CanViewFPLExam")
                                    {

#line default
#line hidden
#nullable disable
            __builder.OpenElement(90, "th");
            __builder.AddContent(91, " Exam Project (");
#nullable restore
#line (112,57)-(112,65) 25 "C:\Users\Nguyen Bui\source\repos\FPLSP3\FPLSP\Pages\UserManagerPages\ListUsersIdentity.razor"
__builder.AddContent(92, de.Value);

#line default
#line hidden
#nullable disable
            __builder.AddContent(93, "), ");
            __builder.CloseElement();
#nullable restore
#line 113 "C:\Users\Nguyen Bui\source\repos\FPLSP3\FPLSP\Pages\UserManagerPages\ListUsersIdentity.razor"
                                    }

                                }

#line default
#line hidden
#nullable disable
#nullable restore
#line 115 "C:\Users\Nguyen Bui\source\repos\FPLSP3\FPLSP\Pages\UserManagerPages\ListUsersIdentity.razor"
                                 
                            }

#line default
#line hidden
#nullable disable
            __builder.CloseElement();
            __builder.AddMarkupContent(94, "\r\n                        ");
            __builder.OpenElement(95, "td");
            __builder.OpenElement(96, "a");
            __builder.AddAttribute(97, "onclick", global::Microsoft.AspNetCore.Components.EventCallback.Factory.Create<global::Microsoft.AspNetCore.Components.Web.MouseEventArgs>(this, 
#nullable restore
#line 123 "C:\Users\Nguyen Bui\source\repos\FPLSP3\FPLSP\Pages\UserManagerPages\ListUsersIdentity.razor"
                                         ()=>GoToDetail((x.Id))

#line default
#line hidden
#nullable disable
            ));
            __builder.AddAttribute(98, "class", "btn btn-danger");
            __builder.AddMarkupContent(99, "Cập nhật quyền");
            __builder.CloseElement();
            __builder.CloseElement();
            __builder.CloseElement();
#nullable restore
#line 125 "C:\Users\Nguyen Bui\source\repos\FPLSP3\FPLSP\Pages\UserManagerPages\ListUsersIdentity.razor"
                }

#line default
#line hidden
#nullable disable
            __builder.CloseElement();
            __builder.CloseElement();
            __builder.AddMarkupContent(100, "\r\n        ");
            __builder.OpenElement(101, "div");
            __builder.AddAttribute(102, "class", "card-footer text-muted");
            __builder.OpenElement(103, "div");
            __builder.AddAttribute(104, "class", "row mt-3");
            __builder.OpenElement(105, "span");
            __builder.OpenComponent<global::FPLSP.Components.Pagingation>(106);
            __builder.AddAttribute(107, "MetaData", global::Microsoft.AspNetCore.Components.CompilerServices.RuntimeHelpers.TypeCheck<global::FPLSP.Server.Data.SeedWork.MetaData>(
#nullable restore
#line 133 "C:\Users\Nguyen Bui\source\repos\FPLSP3\FPLSP\Pages\UserManagerPages\ListUsersIdentity.razor"
                                           MetaData

#line default
#line hidden
#nullable disable
            ));
            __builder.AddAttribute(108, "Spread", global::Microsoft.AspNetCore.Components.CompilerServices.RuntimeHelpers.TypeCheck<global::System.Int32>(
#nullable restore
#line 133 "C:\Users\Nguyen Bui\source\repos\FPLSP3\FPLSP\Pages\UserManagerPages\ListUsersIdentity.razor"
                                                             2

#line default
#line hidden
#nullable disable
            ));
            __builder.AddAttribute(109, "SelectedPage", global::Microsoft.AspNetCore.Components.CompilerServices.RuntimeHelpers.TypeCheck<global::Microsoft.AspNetCore.Components.EventCallback<global::System.Int32>>(global::Microsoft.AspNetCore.Components.EventCallback.Factory.Create<global::System.Int32>(this, 
#nullable restore
#line 133 "C:\Users\Nguyen Bui\source\repos\FPLSP3\FPLSP\Pages\UserManagerPages\ListUsersIdentity.razor"
                                                                              SelectedPage

#line default
#line hidden
#nullable disable
            )));
            __builder.CloseComponent();
            __builder.CloseElement();
            __builder.CloseElement();
            __builder.CloseElement();
            __builder.CloseElement();
#nullable restore
#line 139 "C:\Users\Nguyen Bui\source\repos\FPLSP3\FPLSP\Pages\UserManagerPages\ListUsersIdentity.razor"
}
else
{

#line default
#line hidden
#nullable disable
            __builder.OpenComponent<global::FPLSP.Components.LoadingIndicator>(110);
            __builder.CloseComponent();
#nullable restore
#line 143 "C:\Users\Nguyen Bui\source\repos\FPLSP3\FPLSP\Pages\UserManagerPages\ListUsersIdentity.razor"
}

#line default
#line hidden
#nullable disable
            __builder.OpenComponent<global::FPLSP.Components.Comfirmation>(111);
            __builder.AddAttribute(112, "ConfirmationMessage", "Cập nhập quyền cho toàn bộ người dùng chưa có quyền là quyền sinh viên cơ sở Hà Nội bạn chắc chắc chứ?");
            __builder.AddAttribute(113, "ConfirmationTitle", "Cấp quyền");
            __builder.AddAttribute(114, "ConfirmationChanged", global::Microsoft.AspNetCore.Components.CompilerServices.RuntimeHelpers.TypeCheck<global::Microsoft.AspNetCore.Components.EventCallback<global::System.Boolean>>(global::Microsoft.AspNetCore.Components.EventCallback.Factory.Create<global::System.Boolean>(this, 
#nullable restore
#line 147 "C:\Users\Nguyen Bui\source\repos\FPLSP3\FPLSP\Pages\UserManagerPages\ListUsersIdentity.razor"
                                                    OnConfirmationUpdateUser

#line default
#line hidden
#nullable disable
            )));
            __builder.AddComponentReferenceCapture(115, (__value) => {
#nullable restore
#line 146 "C:\Users\Nguyen Bui\source\repos\FPLSP3\FPLSP\Pages\UserManagerPages\ListUsersIdentity.razor"
                                     UpdateConfirmationUser = (FPLSP.Components.Comfirmation)__value;

#line default
#line hidden
#nullable disable
            }
            );
            __builder.CloseComponent();
        }
        #pragma warning restore 1998
#nullable restore
#line 148 "C:\Users\Nguyen Bui\source\repos\FPLSP3\FPLSP\Pages\UserManagerPages\ListUsersIdentity.razor"
       
    [Inject]
    public IRoleUserIdentityRepo _roleUserIdentityRepo { get; set; }
    [Inject] public IUserIdentityRepo _UserIdentityRepo { get; set; }
    [Inject] public UserManager<UserSignIn> _userManager { get; set; }
    private List<UserInListRoles> _lstUsers { get; set; }
    private List<UserInListRoles> _lstUsersFlag { get; set; }
    private UserRoleSearch userRoleSearch = new UserRoleSearch();
    private List<IdentityRole> _lstRole = new List<IdentityRole>();
    public MetaData MetaData { get; set; } = new MetaData();
    private string ExceptRoleName = "";
    protected Comfirmation UpdateConfirmationUser { get; set; }
    [Inject]
    public CryptoServices _cryptoServices { get; set; }
    [Inject] public IToastService toastService { get; set; }
    [Inject] public NavigationManager navigation { get; set; }
    [Parameter]
    public string maxlevelNonDecrpyt { get; set; }
    [Parameter]
    public string IdCoSoNonDecrpyt { get; set; }
    private List<Claim> _lstRedirect = new List<Claim>();
    private string maxlevel = "";
    public string IdCoSo = "";
    private string getIdCoSo = "";
    [Inject] public IStudentUPRepo _studentUPRepo { get; set; }
    bool IsShowLoading = false;
    void ShowLoading() => IsShowLoading = true;
    void HideLoading() => IsShowLoading = false;
    public async Task OnConfirmationUpdateUser(bool confirmed)
    {
        if (confirmed)
        {
            ShowLoading();
            if (userRoleSearch.StatusNotRole == 1)
            {
                var a = 0;
                foreach (var item in _lstUsersFlag.Where(c => c.ListRoles.Count() == 0).ToList())
                {
                    var _User = await _UserIdentityRepo.GetUserRoleById(item.Id);
                    _User.ListRoles.Add("Student");
                    var caim = _lstRedirect.FirstOrDefault(c => c.Type == "CanViewFPLSPProject");
                    _User.ListRedirectClaims.Add(caim);
                    if (_User.IdTrainingFacility == Guid.Empty)
                    {
                        _User.IdTrainingFacility = Guid.Parse("169A0425-7E5A-4057-9748-32F1CF3C1479");
                        await _userManager.UpdateAsync(_User);
                    }
                    UserUpdateRolesHasClaims userUpdateRoles = new UserUpdateRolesHasClaims()
                        {
                            ID = item.Id,
                            Name = _User.UserName,
                            claims = _User.ListRedirectClaims,
                            RoleNames = _User.ListRoles.ToArray()
                        };
                    if (userUpdateRoles.RoleNames.Any(c => c == "Student"))
                    {
                        var lstStudent = await _studentUPRepo.GetAllStudentDtosAsync();

                        if (lstStudent.Any(c => c.Id == Guid.Parse(_User.Id)))
                        {
                            var studentUP = lstStudent.Find(c => c.Id == Guid.Parse(_User.Id));
                            var update = new FPLSP.Server.Infrastructure.ViewModels.StudentsUPVm.StudentUpdateVM()
                                {
                                    Email = studentUP.Email,
                                    Ethnic = studentUP.Ethnic,
                                    Address = studentUP.Address,
                                    DateOfBirth = studentUP.DateOfBirth,
                                    Description = studentUP.Description,
                                    FathersName = studentUP.FathersName,
                                    Gender = studentUP.Gender,
                                    HomeTown = studentUP.HomeTown,
                                    IdentityCardNumber = studentUP.IdentityCardNumber,
                                    ImageUrl = studentUP.ImageUrl,
                                    IssuedOn = studentUP.IssuedOn,
                                    MotherName = studentUP.MotherName,
                                    PhoneNumber = studentUP.PhoneNumber,
                                    StudentCode = studentUP.StudentCode,
                                    StudentName = studentUP.StudentName,
                                    Password = studentUP.Password,
                                    Status = studentUP.Status,
                                    IsDelete = false

                                };

                            await _studentUPRepo.UpdateStudentUP(studentUP.Id, update);



                        }
                        else
                        {

                            var studentgmail = _User.Email.Split("@")[0];
                            var studentCode = studentgmail.Substring(studentgmail.Length - 7).ToUpper();
                            var studentInClassCreate = new StudentUpDto()
                                {
                                    Email = _User.Email,
                                    Ethnic = "",
                                    Address = "",
                                    DateOfBirth = DateTime.Now,
                                    Description = "",
                                    FathersName = "",
                                    Gender = true,
                                    HomeTown = "",
                                    Id = Guid.Parse(_User.Id),
                                    IdentityCardNumber = "",
                                    ImageUrl = "",
                                    IssuedOn = DateTime.Now,
                                    MotherName = "",
                                    Password = "",
                                    PhoneNumber = "",
                                    Status = 2,
                                    StudentCode = studentCode,
                                    StudentName = ""

                                };
                            await _studentUPRepo.CreateStudentUPstudentInClass(studentInClassCreate);
                        }
                    }

                    //kiểm tra xem tất cả role hiện tại sau khi đã thêm hoặc cập nhật role đã có admin core chưa
                    var res = await _UserIdentityRepo.AddRolesToUser(userUpdateRoles);
                    if (res)
                    {
                        a++;
                    }
                }
                toastService.ShowSuccess($"Cấp quyền thành công cho {a} người");
                await GetTasks();
            }
        }
        else
        {
            HideLoading();
            return;

        }

    }
    protected override async Task OnInitializedAsync()
    {

        //giải mã hóa router values tại đây để phục vụ cho các chức năng khác
        maxlevel = _cryptoServices.Decrypt(maxlevelNonDecrpyt.Replace("I0H", "/"));
        IdCoSo = _cryptoServices.Decrypt(IdCoSoNonDecrpyt.Replace("I0H", "/"));
        getIdCoSo = IdCoSo;
        _lstRedirect.Add(new Claim("CanViewFPLSPProject", "true"));
        _lstRedirect.Add(new Claim("CanViewCabinProject", "true"));
        _lstRedirect.Add(new Claim("CanViewFPLExam", "true"));


        if (maxlevel == "7")
        {
            ExceptRoleName = "AdminCore";
        }
        else if (maxlevel == "6")
        {
            ExceptRoleName = "AdminCS";
        }
        else if (maxlevel == "5")
        {
            ExceptRoleName = "DirectorOfTraining";
        }
        else if (maxlevel == "4")
        {
            ExceptRoleName = "HeadOfDepartment";
        }
        else if (maxlevel == "3")
        {
            ExceptRoleName = "Staff";
        }
        else if (maxlevel == "2")
        {

            ExceptRoleName = "LecturerFPLSP";
        }

        _lstRole = await _roleUserIdentityRepo.GetAllRolesAsync();
        await GetTasks();


    }
    private async Task GetTasks()
    {
        var pagingResponse = await _UserIdentityRepo.GetAllUser(userRoleSearch);
        var _lstUserAll = await _UserIdentityRepo.GetAllListUser();
        //kiểm tra xem nếu khác quyền admin core thì tất cả phải được lọc theo cơ sở đào tạo
        if (maxlevel != "7")
        {
            _lstUsers = pagingResponse.Items.Where(c => c.IdTrainingFacility == Guid.Parse(IdCoSo)).ToList();
            _lstUsersFlag = _lstUserAll.Where(c => c.IdTrainingFacility == Guid.Parse(IdCoSo)).ToList();

        }
        else
        {
            _lstUsers = pagingResponse.Items;
            _lstUsersFlag = _lstUserAll;
        }

        // _lstUsers.Remove(_lstUsers.FirstOrDefault(c => c.UserName == email));
        MetaData = pagingResponse.MetaData;

        if (maxlevel == "7")
        {
            _lstUsers = _lstUsers;
            _lstUsersFlag = _lstUsersFlag;
        }
        else if (maxlevel == "6")
        {
            _lstUsers = _lstUsers.Where(c => c.ListRoles.Any(c => c != "AdminCore")).ToList();
            _lstUsersFlag = _lstUsersFlag.Where(c => c.ListRoles.Any(c => c != "AdminCore")).ToList();
        }
        else if (maxlevel == "5")
        {
            _lstUsers = _lstUsers.Where(c => c.ListRoles.Any(c => c != "AdminCore" && c != "AdminCS")).ToList();
            _lstUsersFlag = _lstUsersFlag.Where(c => c.ListRoles.Any(c => c != "AdminCore" && c != "AdminCS")).ToList();
        }
        else if (maxlevel == "4")
        {
            _lstUsers = _lstUsers.Where(c => c.ListRoles.Any(c => c != "AdminCore" && c != "AdminCS" && c != "DirectorOfTraining")).ToList();
            _lstUsersFlag = _lstUsersFlag.Where(c => c.ListRoles.Any(c => c != "AdminCore" && c != "AdminCS" && c != "DirectorOfTraining")).ToList();
        }
        else if (maxlevel == "3")
        {
            _lstUsers = _lstUsers.Where(c => c.ListRoles.Any(c => c != "AdminCore" && c != "AdminCS" && c != "DirectorOfTraining" && c != "HeadOfDepartment")).ToList();
            _lstUsersFlag = _lstUsersFlag.Where(c => c.ListRoles.Any(c => c != "AdminCore" && c != "AdminCS" && c != "DirectorOfTraining" && c != "HeadOfDepartment")).ToList();
        }
        else if (maxlevel == "2")
        {
            _lstUsers = _lstUsers.Where(c => c.ListRoles.Any(c => c != "AdminCore" && c != "AdminCS" && c != "DirectorOfTraining" && c != "HeadOfDepartment" && c != "Staff")).ToList();
            _lstUsersFlag = _lstUsersFlag.Where(c => c.ListRoles.Any(c => c != "AdminCore" && c != "AdminCS" && c != "DirectorOfTraining" && c != "HeadOfDepartment" && c != "Staff")).ToList();
        }
    }
    private async Task SelectedPage(int page)
    {
        userRoleSearch.PageNumber = page;
        await GetTasksSearch();
    }

    private async Task SearchRole(string role)
    {
        userRoleSearch.Role = role;
        await SearchTask(null);
    }
    private async Task SearchStatsNotRole(int StatsNotRole)
    {
        userRoleSearch.StatusNotRole = StatsNotRole;
        await SearchTask(null);
    }
    private async Task GoToDetail(string idUser)
    {
        var url = Path.Combine($"/detailuser/{_cryptoServices.Encrypt(idUser).Replace("/", "I0H")}/{_cryptoServices.Encrypt(maxlevel.ToString()).Replace("/", "I0H")}/{_cryptoServices.Encrypt(IdCoSo.ToString()).Replace("/", "I0H")}");
        navigation.NavigateTo(url);
    }
    private async Task AddAllUserNotRole()
    {
        UpdateConfirmationUser.show();
    }
    private async Task SearchTask(EditContext context)
    {
        await GetTasksSearch();
    }
    private async Task Clear()
    {
        userRoleSearch = new UserRoleSearch();
        await GetTasksSearch();
    }

    private async Task GetTasksSearch()
    {
        _lstUsers = _lstUsersFlag;
        if (!string.IsNullOrEmpty(userRoleSearch.Name))
        {
            _lstUsers = _lstUsers.Where(c => c.UserName.Contains(userRoleSearch.Name)).ToList();
        }
        if (!string.IsNullOrEmpty(userRoleSearch.Role))
        {
            _lstUsers = _lstUsers.Where(c => c.ListRoles.Contains(userRoleSearch.Role)).ToList();
        }
        if (userRoleSearch.StatusNotRole == 1)
        {
            _lstUsers = _lstUsers.Where(c => c.ListRoles.Count() == 0).ToList();
        }
        var data = _lstUsers.Skip((userRoleSearch.PageNumber - 1) * userRoleSearch.PageSize).Take(userRoleSearch.PageSize).ToList();
        var lstpage = new PageList<UserInListRoles>(data,
            _lstUsers.Count(),
            userRoleSearch.PageNumber,
            userRoleSearch.PageSize);
        _lstUsers = lstpage.Items;
        MetaData = lstpage.MetaData;
    }


#line default
#line hidden
#nullable disable
    }
}
namespace __Blazor.FPLSP.Pages.UserManagerPages.ListUsersIdentity
{
    #line hidden
    internal static class TypeInference
    {
        public static void CreateInputSelect_0<TValue>(global::Microsoft.AspNetCore.Components.Rendering.RenderTreeBuilder __builder, int seq, int __seq0, global::System.Object __arg0, int __seq1, global::System.Linq.Expressions.Expression<global::System.Func<TValue>> __arg1, int __seq2, TValue __arg2, int __seq3, global::Microsoft.AspNetCore.Components.EventCallback<TValue> __arg3, int __seq4, global::Microsoft.AspNetCore.Components.RenderFragment __arg4)
        {
        __builder.OpenComponent<global::Microsoft.AspNetCore.Components.Forms.InputSelect<TValue>>(seq);
        __builder.AddAttribute(__seq0, "class", __arg0);
        __builder.AddAttribute(__seq1, "ValueExpression", __arg1);
        __builder.AddAttribute(__seq2, "Value", __arg2);
        __builder.AddAttribute(__seq3, "ValueChanged", __arg3);
        __builder.AddAttribute(__seq4, "ChildContent", __arg4);
        __builder.CloseComponent();
        }
        public static void CreateInputSelect_1<TValue>(global::Microsoft.AspNetCore.Components.Rendering.RenderTreeBuilder __builder, int seq, int __seq0, global::System.Object __arg0, int __seq1, global::System.Linq.Expressions.Expression<global::System.Func<TValue>> __arg1, int __seq2, TValue __arg2, int __seq3, global::Microsoft.AspNetCore.Components.EventCallback<TValue> __arg3, int __seq4, global::Microsoft.AspNetCore.Components.RenderFragment __arg4)
        {
        __builder.OpenComponent<global::Microsoft.AspNetCore.Components.Forms.InputSelect<TValue>>(seq);
        __builder.AddAttribute(__seq0, "class", __arg0);
        __builder.AddAttribute(__seq1, "ValueExpression", __arg1);
        __builder.AddAttribute(__seq2, "Value", __arg2);
        __builder.AddAttribute(__seq3, "ValueChanged", __arg3);
        __builder.AddAttribute(__seq4, "ChildContent", __arg4);
        __builder.CloseComponent();
        }
    }
}
#pragma warning restore 1591
